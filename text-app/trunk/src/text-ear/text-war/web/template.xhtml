<?xml version="1.0" encoding="UTF-8"?>
<f:view
      xmlns:gui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:ice="http://www.icesoft.com/icefaces/component"
      xmlns:dvn="/WEB-INF/tlds/dvn-components">
<ice:outputDeclaration
      doctypeRoot="HTML"
      doctypePublic="-//W3C//DTD XHTML 1.0 Transitional//EN"
      doctypeSystem="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  
  
  <!-- page title param passed in by param -->
  <title><h:outputText value="#{pageTitle}"/></title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta http-equiv="Content-Language" content="en"/>
  <meta http-equiv="imagetoolbar" content="no"/>
  <link rel="stylesheet" type="text/css" href="/dvn/resources/icefaces/dvn_rime/dvn_rime.css"/>
  <link rel="stylesheet" type="text/css" href="/dvn/resources/css/dvngeneral.css"/>
  <link rel="stylesheet" type="text/css" href="/dvn/resources/css/dvnspecific.css"/>
  <link rel="stylesheet" type="text/css" href="/dvn/resources/css/dvnhome.css"/>
  <link rel="stylesheet" type="text/css" href="/dvn/resources/css/dvnstudy.css"/>
  <!-- IE SPECIFIC STYLESHEET -->
  <ice:outputText escape="false" nospan="true"
    value="&#60;!--[if lte IE 8]&#62;
	&#60;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/dvn/resources/css/iefix.css&#34;/&#62;
    &#60;![endif]--&#62;"/>
  <script type="text/javascript" src="/dvn/resources/javascript/EventCapture.js"/>
  <script type="text/javascript" src="/dvn/resources/javascript/jquery.js"/>
  <script type="text/javascript" src="/dvn/resources/javascript/jquery.corner.js"/>
  <script type="text/javascript" src="/dvn/resources/javascript/excanvas.pack.js"/>
  <script type="text/javascript" src="/dvn/resources/javascript/jquery.ifixpng.js"/>
  <script type="text/javascript" src="/dvn/resources/javascript/jquery.truncator.js"/>
  <script type="text/javascript" src="/dvn/resources/javascript/sgbeal-togglepane.jquery.js"/>
  <script type="text/javascript" src="/dvn/resources/javascript/jquery.accordion.js"/>
  <script type="text/javascript" src="/dvn/resources/javascript/jquery.cookie.js"/>
  <script type="text/javascript" src="/dvn/resources/javascript/jcap.js"/>
  <script type="text/javascript" src="/dvn/resources/javascript/md5.js"/>
  <!-- The following script is in place to make sure that the template code is reloaded when a forward happens
    or when a page goes back to itself but with a different "view" (as with tabs); each page should, if need be,
    define a uniquifier for each "view" (for example, a tabbed page would just use the selectedIndex of the tabSet) -->
  <script src="http://openlayers.org/api/OpenLayers.js"></script>
  <script src="http://proj4js.org/lib/proj4js-compressed.js"></script>
  <script type="text/javascript">
      // <![CDATA[   
           var map;

           function init(){
               OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {
                defaultHandlerOptions: {
                    'single': true,
                    'double': false,
                    'pixelTolerance': 0,
                    'stopSingle': false,
                    'stopDouble': false
                },

                initialize: function(options) {
                    this.handlerOptions = OpenLayers.Util.extend(
                        {}, this.defaultHandlerOptions
                    );
                    OpenLayers.Control.prototype.initialize.apply(
                        this, arguments
                    );
                    this.handler = new OpenLayers.Handler.Click(
                        this, {
                            'click': this.trigger
                        }, this.handlerOptions
                    );
                },

                trigger: function(e) {
                    var lonlat = map.getLonLatFromViewPortPx(e.xy);
                  
                     document.getElementById('ClusterForm:userYCoord').value= lonlat.lat;
                     document.getElementById('ClusterForm:userXCoord').value= lonlat.lon;
                     iceSubmitPartial(document.getElementById('ClusterForm'), document.getElementById('ClusterForm:userYCoord'), null);
                }

            });

               map = new OpenLayers.Map('map');
               var click = new OpenLayers.Control.Click();
                map.addControl(click);
                click.activate();

               map.addControl(new OpenLayers.Control.MousePosition());

               var wms = new OpenLayers.Layer.WMS(
                   "OpenLayers WMS", "http://vmap0.tiles.osgeo.org/wms/vmap0",
                   {layers: 'basic'}
               );
               var setId = document.getElementById("ClusterForm:setId").value;
            
               var layer = new OpenLayers.Layer.Vector("GML", {
                   strategies: [new OpenLayers.Strategy.Fixed()],
                   protocol: new OpenLayers.Protocol.HTTP({
                       url: "/text/ConvexHull?setId="+setId,
                       format: new OpenLayers.Format.GML()
                   })
               });
             //  map.events.register("mousemove", map, function(e) {

               // var position = this.events.getMousePosition(e);
            Â    //  OpenLayers.Util.getElement("coords").innerHTML = position;
               // var lonlat = map.getLonLatFromPixel(position);
                // A mysterious error is causing OpenLayers to return a non-varying fraction after a zoom has been made.
                // This is removed by toFixed().
               // OpenLayers.Util.getElement("coords").innerHTML = lonlat.lon + "<i>m</i>" + lonlat.lat + "<i>m</i>";

           // });

              // map.addLayer(layer);
               map.addLayers([wms, layer]);
               map.zoomToExtent(new OpenLayers.Bounds(
                   -4.0, -4.0, 4.0, 4.0
               ));
           }

      // ]]>
  </script>

 </head>
<!--  this template is example 4.3 in the Facelets Shortcut -->
<body onload="init();" >
   
    
    <div class="dvn_wrapper" id="dvn_wrapper">
        <div class="dvn_content" id="content-frame">
            <!-- required to fix a bug in firefox where the connection status box can be displayed erroneously -->
            <ice:outputConnectionStatus style="position: absolute; left: 610px; top: 80px;" showPopupOnDisconnect="false"/>
            
            <gui:insert name="body">Default Body</gui:insert>
            <div class="dvn_clear"></div>
        </div>
    </div>
   
</body>
</html>
</f:view>
