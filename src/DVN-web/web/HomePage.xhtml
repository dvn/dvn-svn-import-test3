<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:gui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:dvn="/WEB-INF/tlds/dvn-components"
      xmlns:ice="http://www.icesoft.com/icefaces/component">
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>

<body>
  <gui:composition template="/template.xhtml">
    <gui:param name="pageTitle" value="DVN - Home" />

    <gui:define name="body">
      <f:loadBundle basename="Bundle" var="bundle"/>
      <f:loadBundle basename="BundleAnalysis" var="bundleAnalysis"/>
      <script type="text/javascript">
          // <![CDATA[

          jQuery(document).ready(function(){
          jQuery("ul.theMenu").Accordion({active: "h3.selected", header: "h3.head", alwaysOpen: false, animated: true, showSpeed: 400, hideSpeed: 800});
          jQuery("ul.xtraMenu").Accordion({active: "h4.selected", header: "h4.head", alwaysOpen: false, animated: true, showSpeed: 400, hideSpeed: 800});
      });
          function setHiddenValues(groupid) {
            if (arguments.length > 1) {
               document.getElementById('HomePageForm:alphaCharacter').value=arguments[1];
            } else {
               document.getElementById('HomePageForm:groupId').value=arguments[0];
            }
          }

          // ]]>
      </script>

      <ice:form id="HomePageForm">
        <ice:inputHidden id="vdcId" value="#{VDCRequest.currentVDCId}"/>
        <!-- Success Message -->
        <div jsfc="ice:panelGroup" styleClass="#{HomePage.msg.styleClass}" rendered="#{!empty HomePage.msg.messageText}">
          <ice:outputText id="statusMessage" escape="false" value="#{HomePage.msg.messageText}"/>
        </div>

        <div jsfc="ice:panelGroup" styleClass="dvn_hmpgMainMessage" rendered="#{(VDCRequest.vdcNetwork.displayAnnouncements == true) and (VDCRequest.currentVDC == null) }" id="networkAnnouncementsHeaderPanel" >
          <ice:outputText id="networkAnnouncementsMessages" escape="false" value="#{HomePage.parsedNetworkAnnouncements}"/>
        </div>

        <div jsfc="ice:panelGroup" styleClass="dvn_hmpgMainMessage" rendered="#{VDCRequest.currentVDC.displayAnnouncements == true}" id="announcementsHeaderPanel" >
          <ice:outputText rendered="#{VDCRequest.currentVDC.displayAnnouncements == true}" escape="false" value="#{HomePage.parsedLocalAnnouncements}"/>
        </div>

        <!-- Main Section starts here -->
        <div id="dvn_mainSection">
          <!-- Search Section starts here -->
          <div class="dvn_searchblock">
            <div class="dvn_searchBoxContent">
              <div class="dvn_searchTitle"><a name="search" title="">Search Studies</a></div>
              <fieldset>
                <label for="options">
                  <ice:selectOneMenu id="dropdown1" value="#{HomePage.searchField}">
                    <f:selectItem itemLabel="Cataloging Information" itemValue="any" />
                    <f:selectItem itemLabel="- Author" itemValue="authorName" />
                    <f:selectItem itemLabel="- Title" itemValue="title" />
                    <f:selectItem itemLabel="- Study ID" itemValue="studyId" />
                    <f:selectItem itemLabel="Variable Information" itemValue="variable"/>
                  </ice:selectOneMenu>
                </label>
                <label for="search">
                  <ice:inputText onkeypress="if (window.event) return processEvent('', 'form1:searchButton'); else return processEvent(event, 'form1:searchButton');" id="textField2" value="#{HomePage.searchValue}"/>
                </label>
                <label for="button">
                  <ice:commandButton id="searchButton" value="Go" type="submit" action="#{HomePage.search_action}"/>
                </label>
              </fieldset>
              <div class="dvn_searchLinks">
                <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/AdvSearchPage.xhtml">
                  <ice:outputText value="Advanced Search"/>
                </ice:outputLink>
                &#160;| &#160;
                <ice:outputLink value="http://thedata.org/guides/users/search/tips" target="_blank" style="margin: 0;">
                  <ice:outputText value="Tips"/>
                </ice:outputLink>
              </div>
            </div>
          </div>
          <!-- Search Section ends here -->
        </div>
        <!-- Main Section ends here -->
        

        <div id="hiddenDiv" style="display:none;">
          <ice:outputText value="#{NetworkStatsBean.autoLoad}"/>
        </div>


        <!-- ***************** NETWORK HOMEPAGE CONTENT *************************  -->

        <div jsfc="ice:panelGroup" styleClass="#{!empty(HomePage.accordionItemBeans ) ? 'dvn_section dvn_overflow' : 'dvn_section'}">
            <!-- START THE MENU -->
            <div jsfc="ice:panelGroup" styleClass="dvn_sectionPanels" rendered="#{!empty(HomePage.accordionItemBeans)}">
            <div jsfc="ice:panelGroup" styleClass="dvnTreeBlock" style="height: 65em;">
                  <div class="dvnTreeContainer theMenuContainer">

                    <!-- START ACCORDION -->
                     <!-- All Dataverses -->

                        <ul class="theMenu">
                            <li><!-- restore  style="position: static;" -->
                                        <h3 class="head">
                                            <ice:commandLink onclick="setHiddenValues(-1);"
                                                            partialSubmit="true"
                                                            styleClass="noChild">
                                                <ice:outputText value="Show All Dataverses"/>
                                                <f:attribute name="groupId" value="-1"/>
                                            </ice:commandLink>
                                        </h3>
                            </li>
                        </ul>
                    <ice:panelSeries rendered="#{HomePage.accordionItemBeans!=null}"
                                value="#{HomePage.accordionItemBeans}"
                                var="menuItems">

                        <h3 class="headFilter">
                                <ice:outputText value="Filter by #{menuItems.name}"/>
                        </h3>
                       
                        <gui:repeat rendered="#{menuItems != null}"
                                value="#{menuItems.childItems}"
                                var="item">
                            <ul class="theMenu">
                                <!-- HAS SUBNODE DESCENDANTS -->

                                <gui:fragment rendered="#{ !empty(item.xtraItems)}">
                                  <li>
                                    <ul class="xtraMenu">
                                            <li><!-- restore  style="position: static;" -->
                                                <h4 class="head">
                                                    <ice:commandLink onclick="setHiddenValues(#{item.id});"
                                                                        partialSubmit="true">
                                                        <ice:outputText value="#{item.name}"/>
                                                        <f:attribute name="groupId" value="#{item.id}"/>
                                                     </ice:commandLink>
                                                </h4>
                                                <ul><!-- TODO: CHANGE TO DISPLAY:NONE; -->

                                                    <gui:repeat rendered="#{item.xtraItems != null}"
                                                                value="#{item.xtraItems}"
                                                                var="xtraItems">

                                                        <li>
                                                            <ice:commandLink onclick="setHiddenValues(#{xtraItems.id});"
                                                                                partialSubmit="true">
                                                                <ice:outputText value="#{xtraItems.name}"/>
                                                                <f:attribute name="groupId" value="#{xtraItems.id}"/>
                                                            </ice:commandLink>
                                                        </li>

                                                    </gui:repeat>

                                                 </ul>
                                            </li>
                                        </ul>
                                    </li>
                                  </gui:fragment>
                                <!-- END HAS SUBNODE DESCENDANTS -->

                                <!-- HAS NO SUBNODE DESCENDANTS -->
                                <gui:fragment rendered="#{ empty(item.xtraItems)}">
                                    <li><!-- restore  style="position: static;" -->
                                                <h3 class="head">
                                                    <ice:commandLink onclick="setHiddenValues(#{item.id});"
                                                                    partialSubmit="true"
                                                                    styleClass="noChild">
                                                        <ice:outputText value="#{item.name}"/>
                                                        <f:attribute name="groupId" value="#{item.id}"/>
                                                    </ice:commandLink>
                                                </h3>
                                    </li>
                                </gui:fragment>
                                <!-- END HAS NO SUBNODE DESCENDANTS -->

                            </ul>
                        </gui:repeat>
                    </ice:panelSeries>
                  </div>
            </div>
          </div>
          <!-- END THE MENU -->
          <!-- MAIN CONTENT AREA -->
          <div jsfc="ice:panelGroup" styleClass="#{ !empty(HomePage.accordionItemBeans) ? 'dvn_sectionContent' : 'dvn_sectionContentNoPanels'}">
              <div jsfc="ice:panelGroup" 
                    styleClass="dvnHmpgGroupHeaderBlock"
                    id="createDataverse"
                    rendered="#{HomePage.showRequestCreator}"
                    style="display:block; float:right; padding-right: 5px;">
               <ice:outputLink styleClass="dvnHmpgGroupCreateLink" value="/dvn/faces/login/CreatorRequestInfoPage.xhtml">
                 <ice:outputText value="Create your own Dataverse" escape="false"/>
               </ice:outputLink>
             </div>
             <div class="dvnHmpgGroupTableHeaderBlock"
                    style="clear:both;">
                    <div class="dvnHmpgGroupHeaderBlock">
                      <ice:outputText styleClass="dvnHmpgGroupHeader" value="#{HomePage.groupName}"/>
                    </div>
                    <div jsfc="ice:panelGroup"
                        rendered="#{!empty(HomePage.vdcUIList.vdcUIList) and VDCRequest.currentVDC == null}"
                        style="display:block; margin-right:10px; float:right;">
                      <ul class="alphaBrowse">
                          <li>
                                <ice:commandLink  onclick="setHiddenValues(-1,'All');">
                                    <ice:outputText value="ALL"/>
                                </ice:commandLink>
                          </li>
                          <gui:repeat value="#{HomePage.alphaCharacterList}"
                                        var="item">
                          <li>
                                <ice:commandLink  onclick="setHiddenValues(document.getElementById('HomePageForm:groupId').value, '#{item}');">
                                    <ice:outputText value="#{item}"/>
                                    <f:attribute name="groupId" value="#{item.id}"/>
                                    <f:attribute name="alphaCharacter" value="#{item}"/>
                                </ice:commandLink>
                          </li>
                          </gui:repeat>
                      </ul>
                     </div>
                      
              </div>
                 <div jsfc="ice:panelGroup" styleClass="dvnHmpgGroupNoDVs" rendered="#{HomePage.group.description != null and HomePage.group.description != ''}">
                        <p><ice:outputText value="#{HomePage.group.description}"/></p>
                 </div>
                 <div jsfc="ice:panelGroup" style="padding-left:25px;" styleClass="dvnHmpgGroupNoDVs" rendered="#{ HomePage.vdcUIListSize == 0 }">
                      <p><ice:outputText value="There are no dataverses to display for the selected filter. Please select again."/></p>
                 </div>

              
              <div jsfc="ice:panelGroup" rendered="#{ !empty(HomePage.vdcUIList.vdcUIList) }" styleClass="dvnHmpgGroupTableWrap">

                <ice:panelGrid cellpadding="0" cellspacing="0" border="0" columns="2" id="gridPanel2"
                               styleClass="dvnHmpgGroupTableTop"
                               columnClasses="dvnHmpgGroupTotals, dvnPaginatorWrap">
                  <div jsfc="ice:panelGroup"
                            id="groupPanel1"
                            rendered="#{!empty(HomePage.vdcUIList.vdcUIList) and VDCRequest.currentVDC == null}"
                            style="float:left;">
                    <ice:outputText styleClass="dvn_totalsLabel" value ="Dataverses: "/><ice:outputText styleClass="dvn_totalsValue" value="#{HomePage.vdcUIListSize}"/>
                    <ice:outputText styleClass="dvn_totalsLabel" value ="Studies: "/><ice:outputText styleClass="dvn_totalsValue" value="#{HomePage.networkStats.studyCount}"/>
                    <ice:outputText styleClass="dvn_totalsLabel" value="Files: " /><ice:outputText styleClass="dvn_totalsValue" value="#{HomePage.networkStats.fileCount}"/>
                  </div>
                  <div jsfc="ice:panelGroup" 
                        id="groupPanel2"
                        rendered="#{HomePage.vdcUIListSize > 10 and VDCRequest.currentVDC == null}"
                        style="float:right;">


                    <ice:dataPaginator  for="dataverseList"
                                        id="dataScroll_3"
                                        paginator="true" fastStep="3"
                                        paginatorMaxPages="4"
                                        renderFacetsIfSinglePage="true"
                                        styleClass="dvnPaginatorRight">
                      <f:facet name="first">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-first.gif" title="First Page"/>
                      </f:facet>
                      <f:facet name="previous">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-previous.gif" title="Previous"/>
                      </f:facet>
                      <f:facet name="next">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-next.gif" title="Previous"/>
                      </f:facet>
                      <f:facet name="last">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-last.gif" title="Previous"/>
                      </f:facet>
                    </ice:dataPaginator>
                  </div>
                </ice:panelGrid>
              </div>
              <div jsfc="ice:panelGroup" rendered="#{!empty(HomePage.vdcUIList.vdcUIList)}"> 

              <ice:dataTable headerClass="groupRow" id="dataverseList"
                               rendered="#{ !empty(HomePage.vdcUIList.vdcUIList) }"
                               rowClasses="evenRow oddRow" rows="10" width="100%" columnWidths="35%,35%,10%,10%,10%"
                               sortColumn="#{HomePage.vdcUIList.sortColumnName}"
                               sortAscending="#{HomePage.vdcUIList.ascending}"
                               styleClass="dvnHmpgGroupDataTable"
                               value="#{HomePage.vdcUIList.vdcUIList}" var="item"><!-- this is a list of vdcs -->
                  <!-- name number -->
                  <f:facet name="header">

                  </f:facet>
                  <ice:column>
                    <f:facet name="header">
                      <ice:commandSortHeader
                        columnName="#{HomePage.vdcUIList.nameColumnName}"
                        arrow="true">
                        <ice:outputText value="#{HomePage.vdcUIList.nameColumnName}"/>
                      </ice:commandSortHeader>
                    </f:facet>
                    <ice:outputLink id="hideShow" 
                                    onclick="getNextSibling(this);"
                                    rendered="#{item.vdc.dvnDescription != null}"
                                    styleClass="dvnHmpgMoreInfoLink"
                                    value="javascript:void(0);">
                      <ice:outputText id="more_info" value="more info [+]"/>
                    </ice:outputLink>
                    <ice:outputLink id="dataverse_link" value="/dvn/dv/#{item.vdc.alias}">
                      <ice:outputText value="#{item.vdc.name}"/>
                    </ice:outputLink>
                    <div id="hideShow_description" class="dvnHmpgDvMoreInfoDesc" style="display: none;">
                      <ice:outputText rendered="#{item.vdc.dvnDescription != null}" value="#{item.vdc.dvnDescription}"/>
                    </div>
                  </ice:column>
                  <!-- affiliation -->
                  <ice:column>
                   <f:facet name="header">
                      <ice:commandSortHeader
                        columnName="#{HomePage.vdcUIList.affiliationColumnName}"
                        arrow="true">
                        <ice:outputText value="#{HomePage.vdcUIList.affiliationColumnName}"/>
                      </ice:commandSortHeader>
                    </f:facet>
                    <ice:outputText value="#{item.vdc.affiliation}"/>
                  </ice:column>
                
                  <!-- DateReleased  -->
                  <ice:column>
                   <f:facet name="header">
                      <ice:commandSortHeader
                        columnName="#{HomePage.vdcUIList.dateReleasedColumnName}"
                        arrow="true">
                        <ice:outputText value="#{HomePage.vdcUIList.dateReleasedColumnName}"/>
                      </ice:commandSortHeader>
                    </f:facet>
                    <ice:outputText value="#{item.vdc.releaseDate}"/>
                  </ice:column>

                  <!-- Activity -->
                  <ice:column styleClass="activityColumn">
                   <f:facet name="header">
                      <ice:commandSortHeader
                        columnName="#{HomePage.vdcUIList.activityColumnName}"
                        arrow="true">
                        <ice:outputText value="#{HomePage.vdcUIList.activityColumnName}"/>
                      </ice:commandSortHeader>
                    </f:facet>
                    <div class="activity">
                      <div jsfc="ice:panelGroup" styleClass="#{item.activityClass}">
                        <span class="numbervalue">0</span>
                      </div>
                    </div>
                  </ice:column>
                </ice:dataTable>
              </div>
         <!-- </gui:repeat> -->
          <!-- DEBUG END - new data table for dbs -->
              </div>
              <ice:inputHidden  binding="#{HomePage.hiddenAlphaCharacter}"
                                    id="alphaCharacter"
                                    valueChangeListener="#{HomePage.changeAlphaCharacter}"
                                    />
                   <ice:inputHidden  binding="#{HomePage.hiddenGroupId}"
                                        id="groupId"
                                        valueChangeListener="#{HomePage.changeGroupId}"
                                        />


          <!-- OLD MENU -->
          <!-- moved because the new menu causes layout to shift when there is no dataverse to display -->
          <!-- END OLD MENU -->
          <ice:messages></ice:messages>
          <!-- Dataverse Homepage -->
      
        </div>
      </ice:form>

    </gui:define>
  </gui:composition>
</body>
</html>