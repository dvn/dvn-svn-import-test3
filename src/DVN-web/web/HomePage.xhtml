<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:gui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:dvn="/WEB-INF/tlds/dvn-components"
      xmlns:ice="http://www.icesoft.com/icefaces/component">
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>

<body>
  <gui:composition template="/template.xhtml">
    <gui:param name="pageTitle" value="DVN - Home" />

    <gui:define name="body">
      <f:loadBundle basename="Bundle" var="bundle"/>
      <f:loadBundle basename="BundleAnalysis" var="bundleAnalysis"/>


      <ice:form>
        <ice:inputHidden id="vdcId" value="#{VDCRequest.currentVDCId}"/>
        <!-- Success Message -->
        <div jsfc="ice:panelGroup" styleClass="#{HomePage.msg.styleClass}" rendered="#{!empty HomePage.msg.messageText}">
          <ice:outputText id="statusMessage" escape="false" value="#{HomePage.msg.messageText}"/>
        </div>

        <div jsfc="ice:panelGroup" styleClass="dvn_hmpgMainMessage" rendered="#{(VDCRequest.vdcNetwork.displayAnnouncements == true) and (VDCRequest.currentVDC == null) }" id="networkAnnouncementsHeaderPanel" >
          <ice:outputText id="networkAnnouncementsMessages" escape="false" value="#{HomePage.parsedNetworkAnnouncements}"/>
        </div>

        <div jsfc="ice:panelGroup" styleClass="dvn_hmpgMainMessage" rendered="#{VDCRequest.currentVDC.displayAnnouncements == true}" id="announcementsHeaderPanel" >
          <ice:outputText rendered="#{VDCRequest.currentVDC.displayAnnouncements == true}" escape="false" value="#{HomePage.parsedLocalAnnouncements}"/>
        </div>

        <!-- Main Section starts here -->
        <div id="dvn_mainSection">
          <div id="dvn_mainSectionTitle">
            <ice:outputText value="Dataverses" rendered="#{VDCRequest.currentVDC == null}"/>
            <ice:outputText value="Studies" rendered="#{VDCRequest.currentVDC != null}" />
          </div>

          <div jsfc="ice:panelGroup" id="createDataverse" styleClass="requestHmpgSide" rendered="#{HomePage.showRequestCreator}">
            <ice:outputLink styleClass="requestHmpgSideLink" value="/dvn/faces/login/CreatorRequestInfoPage.xhtml">
              <ice:outputText value="Create your own Dataverse" escape="false"/>
            </ice:outputLink>
          </div>

          <div jsfc="ice:panelGroup" id="beContributor" styleClass="requestHmpgSide" rendered="#{HomePage.showRequestContributor}">
            <ice:outputLink styleClass="requestHmpgSideLink"  value="/dvn/dv/#{VDCRequest.currentVDC.alias}/faces/login/ContributorRequestInfoPage.xhtml">
              <ice:outputText value="Become a Contributor" escape="false"/>
            </ice:outputLink>
          </div>

          <!-- Search Section starts here -->
          <div class="dvn_searchblock">
            <div class="dvn_searchBoxContent">
              <div class="dvn_searchTitle"><a name="search" title="">Search</a></div>
              <fieldset>
                <label for="options">
                  <ice:selectOneMenu id="dropdown1" value="#{HomePage.searchField}">
                    <f:selectItem itemLabel="Cataloging Information" itemValue="any" />
                    <f:selectItem itemLabel="- Author" itemValue="authorName" />
                    <f:selectItem itemLabel="- Title" itemValue="title" />
                    <f:selectItem itemLabel="- Study ID" itemValue="studyId" />
                    <f:selectItem itemLabel="Variable Information" itemValue="variable"/>
                  </ice:selectOneMenu>
                </label>
                <label for="search">
                  <ice:inputText onkeypress="if (window.event) return processEvent('', 'form1:searchButton'); else return processEvent(event, 'form1:searchButton');" id="textField2" value="#{HomePage.searchValue}"/>
                </label>
                <label for="button">
                  <ice:commandButton id="searchButton" value="Go" type="submit" action="#{HomePage.search_action}"/>
                </label>
              </fieldset>
              <div class="dvn_searchLinks">
                <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/AdvSearchPage.xhtml">
                  <ice:outputText value="Advanced Search"/>
                </ice:outputLink>
                <ice:outputText value=" | " escape="true"/>
                <ice:outputLink value="http://thedata.org/guides/users/search/tips" target="_blank" style="margin: 0;">
                  <ice:outputText value="Tips"/>
                </ice:outputLink>
              </div>
            </div>
          </div>
          <!-- Search Section ends here -->
        </div>
        <!-- Main Section ends here -->

        <div id="hiddenDiv" style="display:none;">
          <ice:outputText value="#{NetworkStatsBean.autoLoad}"/>
        </div>
        <!-- ***************** NETWORK HOMEPAGE CONTENT *************************  -->

        <!-- ADD STYLE CLASS 'dvn_sectionContent' TO THE PANELSERIES BELOW IN ORDER TO
            DISPLAY AREA WHERE THE GROUP FILTER LINKS WILL GO ON THE PAGE. A RENDER IS
            NEEDED TO ADD/REMOVE THAT CLASS WHEN NECESSARY. -->

        <ice:panelSeries styleClass="#{ ( (HomePage.classificationsSize > 0) ? 'dvn_networkHomePanel dvn_sectionContent' : 'dvn_networkHomePanel') }"
                         value="#{HomePage.itemBeans}"
                         var="dvItems"
                         rendered="#{VDCRequest.currentVDC == null}"
                         style="border: 0px solid gold;">
          <ice:outputText   rendered="#{dvItems.recordType eq 'group'}"
                            style="font-size: 1.5em !important; font-weight: bold;"
                            value="#{dvItems.name}"/>
                            <!-- Placeholder for TODO: what output when group is empty? -->
         <div  jsfc="ice:panelGroup"
                align="center"
                rendered="#{dvItems.recordType eq 'group'}"
                style="float: left; width: 100%; padding-top:10px; padding-bottom:10px;">
            <ice:outputText rendered="#{ (empty(dvItems.childItems) and (dvItems.recordType eq 'group') )}"
                            value="There are no dataverses to display in this group."/>
          </div>
          <div  jsfc="ice:panelGroup"
                rendered="#{dvItems.recordType eq 'group'}"
                style="margin-top: .5em;
                border: 1px solid #d9d9d9;
                border-bottom: 1px solid transparent;">
            <div jsfc="ice:panelGroup" 
                    rendered="#{not empty(dvItems.childItems) }"
                    style="overflow: hidden; margin-bottom: .25em;">

              <div style="float: left; width: 100%; padding-top: 4px;">
                <div jsfc="ice:panelGroup" 
                            rendered="#{not empty(dvItems.childItems)and VDCRequest.currentVDC == null }"
                            style="float: left; width: 60%; padding-top: 2px; padding-bottom: 2px;">
                    <h:outputText binding="#{NetworkStatsBean.inlineDataverseKey}"
                                  effect="#{item.effect}"
                                  styleClass="dvn_totalsLabel"
                                  value="#{NetworkStatsBean.inlineDataverseValue}">
                      <f:attribute name="itemid" styleClass="dvn_totalsValue" value="item#{dvItems.id}"/>
                    </h:outputText>
                    <!-- TODO: For the next two rendered was, #{dvItems.parentClassification == 0} -->
                    <h:outputText binding="#{NetworkStatsBean.inlineStudyKey}"
                                  effect="#{item.effect}"
                                  rendered="true"
                                  value="#{NetworkStatsBean.inlineStudyValue}">
                      <f:attribute name="itemid" value="item#{dvItems.id}"/>
                    </h:outputText>
                    <h:outputText binding="#{NetworkStatsBean.inlineFilesKey}"
                                  effect="#{item.effect}"
                                  rendered="true"
                                  value="#{NetworkStatsBean.inlineFilesValue}">
                      <f:attribute name="itemid" value="item#{dvItems.id}"/>
                    </h:outputText>
                </div>
                
                <div jsfc="ice:panelGroup" rendered="#{not empty(dvItems.childItems) }" style="float: right; width: 20%;">
                  <ice:dataPaginator id="dataScroll_3"
                                     for="dataverseList"
                                     paginator="true"
                                     fastStep="3"
                                     paginatorMaxPages="4"
                                     style="margin: 0; padding: 0; float: right;">
                    <f:facet name="first">
                      <ice:graphicImage
                        url="./xmlhttp/css/xp/css-images/arrow-first.gif"
                        style="border:none;"
                        title="First Page"/>
                    </f:facet>
                    <f:facet name="previous">
                      <ice:graphicImage
                        url="./xmlhttp/css/xp/css-images/arrow-previous.gif"
                        style="border:none;"
                        title="Previous"/>
                    </f:facet>
                    <f:facet name="next">
                      <ice:graphicImage
                        url="./xmlhttp/css/xp/css-images/arrow-next.gif"
                        style="border:none;"
                        title="Previous"/>
                    </f:facet>
                    <f:facet name="last">
                      <ice:graphicImage
                        url="./xmlhttp/css/xp/css-images/arrow-last.gif"
                        style="border:none;"
                        title="Previous"/>
                    </f:facet>
                  </ice:dataPaginator>
                </div>
              </div>

              <!-- DONT BELIEVE THIS FUNCTIONALITY IS BEING USED ANY LONGER BECAUSE WE ARE USING THE SIDE FILTER LINKS
              <ice:commandLink immediate="true" action="#{dvItems.toggleSubGroupAction}">
                <ice:graphicImage style="border:0px solid; vertical-align:middle;" value="#{dvItems.expandContractImage}"/>
              </ice:commandLink>
              -->
            </div>
          </div>

          <!-- Start Browse section (with side panels, if available) -->
          <div jsfc="ice:panelGroup" rendered="#{not empty(dvItems.childItems) }">
            <ice:dataTable headerClass="groupRow"
                           id="dataverseList"
                           rendered="#{not empty(dvItems.childItems) }"
                           rowClasses="evenRow oddRow"
                           rows="10" width="100%"
                           sortColumn="#{dvItems.sortColumnName}"
                           sortAscending="#{dvItems.ascending}"
                           styleClass="dvn_networkHomePanelInner"
                           value="#{dvItems.childItems}"
                           var="items"
                           style="margin-bottom: 1em; margin-top: 0;">
              <!-- name number -->
              <f:facet name="header">

              </f:facet>
              <ice:column style="width: 35%;">
                <f:facet name="header">
                  <ice:commandSortHeader
                    columnName="#{dvItems.nameColumnName}"
                    arrow="true">
                    <ice:outputText value="#{dvItems.nameColumnName}"/>
                  </ice:commandSortHeader>
                </f:facet>
                <ice:outputLink id="hideShow" rendered="#{items.shortDescription != null}" value="javascript:void(0);" style="display: inline; float: right;" onclick="getNextSibling(this);">
                  <ice:outputText id="more_info" value="more info [+]"/>
                </ice:outputLink>
                <ice:outputLink id="dataverse_link" value="/dvn/dv/#{items.alias}">
                  <ice:outputText value="#{items.name}"/>
                </ice:outputLink>
                <div id="hideShow_description" style="display:none; width:400px; z-Index:500;">
                  <ice:outputText value="#{items.shortDescription}"/>
                </div>
              </ice:column>
              <!-- affiliation -->
              <ice:column style="width: 35%;">
                <f:facet name="header">
                  <ice:commandSortHeader
                    columnName="#{dvItems.affiliationColumnName}"
                    arrow="true">
                    <ice:outputText value="#{dvItems.affiliationColumnName}"/>
                  </ice:commandSortHeader>
                </f:facet>
                <ice:outputText value="#{items.affiliation}"/>
              </ice:column>

              <!-- DateReleased  -->
              <ice:column style="width: 10%;">
                <f:facet name="header">
                  <ice:commandSortHeader
                    columnName="#{dvItems.dateReleasedColumnName}"
                    arrow="true">
                    <ice:outputText value="#{dvItems.dateReleasedColumnName}"/>
                  </ice:commandSortHeader>
                </f:facet>
                <ice:outputText value="#{items.releaseDate}"/>
              </ice:column>

              <!-- Last Update -->
              <ice:column style="width: 10%;">
                <f:facet name="header">
                  <ice:commandSortHeader
                    columnName="#{dvItems.lastUpdatedColumnName}"
                    arrow="true">
                    <ice:outputText value="#{dvItems.lastUpdatedColumnName}"/>
                  </ice:commandSortHeader>
                </f:facet>
                <ice:outputText value="#{items.lastUpdateTime}"/>
              </ice:column>

              <!-- Activity -->
              <ice:column style="width: 10%;">
                <f:facet name="header">
                  <ice:commandSortHeader
                    columnName="#{dvItems.activityColumnName}"
                    arrow="true">
                    <ice:outputText value="#{dvItems.activityColumnName}"/>
                  </ice:commandSortHeader>
                </f:facet>
                <div class="activity">
                  <div jsfc="ice:panelLayout" styleClass="#{items.activity}">
                    <span class="numbervalue">0</span>
                  </div>
                </div>

                <!-- <ice:outputText value="#{items.activity}"/> -->
              </ice:column>
            </ice:dataTable>
            <!-- BELIEVE THIS WONT NEED TO BE DISPLAYED BECAUSE OF THE PAGINATION AND DATAVERSE/STUDY/FILE COUNTER
            <ice:dataPaginator id="dataScroll_2" for="dataverseList"
                               rowsCountVar="rowsCount"
                               displayedRowsCountVar="displayedRowsCount"
                               firstRowIndexVar="firstRowIndex"
                               lastRowIndexVar="lastRowIndex"
                               pageCountVar="pageCount"
                               pageIndexVar="pageIndex">
              <ice:outputFormat
                styleClass="standard"
                value="{0} dataverses found, displaying {1} dataverse(s), from {2} to {3}. Page {4} / {5}.">
                <f:param value="#{rowsCount}"/>
                <f:param value="#{displayedRowsCount}"/>
                <f:param value="#{firstRowIndex}"/>
                <f:param value="#{lastRowIndex}"/>
                <f:param value="#{pageIndex}"/>
                <f:param value="#{pageCount}"/>
              </ice:outputFormat>
            </ice:dataPaginator>
            -->
          </div>
          
        </ice:panelSeries>

        <div jsfc="ice:panelGroup"
                rendered="#{HomePage.classificationsSize > 0}"
                styleClass="dvn_sectionPanels">
          <!-- This is where the group filter-links should go... There also needs to be a
          render on the style class dvn_sectionPanels. I have add the style class, but a
          render will be needed to display/remove it when necessary. -->

          <div class="dvnNetworkHmpgDvListNav">
          
          <ice:tree id="tree"
              value="#{HomePage.model}"
              var="node"
              hideRootNode="false"
              hideNavigation="false"
              imageDir="/dvn/resources/icefaces/dvn_rime/css-images/"
              rendered="#{HomePage.classificationsSize > 0}">
            <ice:treeNode>
                <f:facet name="icon">
                    <ice:panelGroup
                            style="display: inline" >
                        <ice:graphicImage
                             value="/resources/icefaces/dvn_rime/css-images/#{node.userObject.icon}"/>
                    </ice:panelGroup>
                </f:facet>
                <f:facet name="content">
                    <ice:panelGroup
                            styleClass="selectedNode#{node.userObject eq HomePage.selectedUserObject}"
                            style="display: inline" >
                        <ice:commandLink actionListener="#{HomePage.groupingNodeSelected}"
                                            binding="#{HomePage.linkSelect}">
                            <f:attribute name="groupingId" value="#{node.userObject.grouping.id}" />
                            <ice:outputText id="TreeNode"
                                            value="#{node.userObject.text}"/>
                        </ice:commandLink>
                    </ice:panelGroup>
                </f:facet>
            </ice:treeNode>
        </ice:tree>
        </div>
      </div>

        <ice:messages></ice:messages>
        <!-- Dataverse Homepage -->

                  <!-- This is temporary until Dataverse homepage ans search results page are changed -->

        <ice:outputLink value="/dvn/dv/#{VDCRequest.currentVDC.alias}/faces/StudyListingPage.xhtml?mode=1&amp;collectionId=#{VDCRequest.currentVDC.rootCollection.id}" rendered="#{VDCRequest.currentVDC != null}">
          <ice:outputText value="#{VDCRequest.currentVDC.name} Dataverse - Study Listing (temporary link)" />
        </ice:outputLink>

      </ice:form>

    </gui:define>
  </gui:composition>
</body>
</html>