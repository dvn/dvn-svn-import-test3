<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:gui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:ice="http://www.icesoft.com/icefaces/component"
      xmlns:t="/WEB-INF/tlds/scroller">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>

<body>
  <gui:composition template="/template.xhtml">
    <gui:param name="pageTitle" value="DVN - Search"/>
    <gui:define name="body">
      <ice:form id="form1">
        <ice:inputHidden id="vdcId" value="#{VDCRequest.currentVDCId}"/>
        <input type="hidden" name="pageName" value="StudyListingPage"/>

        <ice:inputHidden id="studyListingIndex" value="#{StudyListingPage.studyListingIndex}"/>
        <!-- Main Section starts here -->
        <div id="dvn_mainSection">
          <!-- Search Section starts here -->
          <div class="dvn_searchblock">
            <div class="dvn_searchBoxContent">
              <div class="dvn_searchTitle"><a title="" name="search">Search Studies</a></div>
              <fieldset>
                <label for="options">
                  <ice:selectOneMenu id="dropdown1" value="#{StudyListingPage.searchField}">
                    <f:selectItem itemLabel="Cataloging Information" itemValue="any"/>
                    <f:selectItem itemLabel="- Author" itemValue="authorName"/>
                    <f:selectItem itemLabel="- Title" itemValue="title"/>
                    <f:selectItem itemLabel="- Global ID" itemValue="globalId"/>
                    <f:selectItem itemLabel="Variable Information" itemValue="variable"/>
                  </ice:selectOneMenu>
                </label>
                <label for="search">
                  <ice:inputText onkeypress="if (window.event) return processEvent('', 'form1:search'); else return processEvent(event, 'form1:search');" id="textField2" value="#{StudyListingPage.searchValue}"/>
                </label>
                <ice:outputLabel for="filter" styleClass="dvnSearchBoxCheckbox" rendered="#{StudyListingPage.renderSearchResultsFilter}">
                  <ice:selectBooleanCheckbox value="#{StudyListingPage.searchResultsFilter}"/>
                  <ice:outputText value="within these results"/>
                </ice:outputLabel>
                <ice:outputLabel for="filter" styleClass="dvnSearchBoxCheckbox" rendered="#{StudyListingPage.renderSearchCollectionFilter}">
                  <ice:selectBooleanCheckbox value="#{StudyListingPage.searchCollectionFilter}"/>
                  <ice:outputText value="within this collection"/>
                </ice:outputLabel>
                <label for="button">
                  <ice:commandButton id="search" value="Go" action="#{StudyListingPage.search_action}"/>
                </label>
              </fieldset>
              <div class="dvn_searchLinks">
                <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/AdvSearchPage.xhtml">
                  <ice:outputText value="Advanced Search"/>
                </ice:outputLink>
                &#160;| &#160;
                <ice:outputLink value="http://thedata.org/guides/users/search/tips" target="_blank">
                  <ice:outputText value="Tips"/>
                </ice:outputLink>
              </div>
            </div>
          </div>
          <!-- Search Section ends here -->
  <!-- Start Search Results (with side panel, if available) -->
          <div jsfc="ice:panelGroup" styleClass="#{ (StudyListingPage.renderTree) ? 'dvn_section dvn_overflow' : 'dvn_section'}">
            <div jsfc="ice:panelGroup" styleClass="#{ (StudyListingPage.renderTree) ? 'dvn_sectionContent' : 'dvn_sectionContentNoPanels'}">
              <!-- This is the old search results text and can be removed
              <div>
                <ice:outputText value="This is where search terms should go..."/>
                <ice:outputText value="#{StudyListingPage.subListHeader}"/>
                <ice:outputText id="listMessagePrefix" value="#{StudyListingPage.listMessagePrefix}"/>
                <ice:outputText id="listMessageContent" styleClass="warnMessage" value="#{StudyListingPage.listMessageContent}"/>
                <ice:outputText id="listMessageSuffix" value="#{StudyListingPage.listMessageSuffix}"/>
              </div> -->
              <div jsfc="ice:panelGroup" styleClass="dvnStudyListCollectionNameBlock">
                <div jsfc="ice:panelGroup" id="beContributor" styleClass="dvnStudyListContributorBlock" rendered="#{HomePage.showRequestContributor}">
                  <ice:outputLink styleClass="dvnStudyListContributorLink" value="/dvn/dv/#{VDCRequest.currentVDC.alias}/faces/login/ContributorRequestInfoPage.xhtml">
                    <ice:outputText value="Become a Contributor" escape="false"/>
                  </ice:outputLink>
                </div>
                <div jsfc="ice:panelGroup" styleClass="dvnStudyListCollectionName">
                  <ice:outputText value="#{StudyListingPage.collectionName}"/>
                  <ice:outputText value="Search Results" rendered="#{(StudyListingPage.studyListing.mode == 2)}"/>
                  <ice:outputText styleClass="dvnStudyListSearchResultsMessage" value="#{StudyListingPage.listMessagePrefix}" rendered="#{(StudyListingPage.studyListing.mode == 2 and StudyListingPage.studyCount != 0)}"/>
                  <ice:outputText styleClass="dvnStudyListSearchResultsMessage" value="#{StudyListingPage.listMessageContent}" rendered="#{(StudyListingPage.studyListing.mode == 2 and StudyListingPage.studyCount != 0)}"/>
                </div>
              </div>
              <div class="dvnStudyListWrapper">
                <div jsfc="ice:panelGroup" styleClass="dvnStudyListNoStudies" rendered="#{StudyListingPage.studyCount == 0 and StudyListingPage.studyListing.mode != 2}">
                  <p><ice:outputText value="There are no studies in the dataverse."/></p>
                </div>
                <div jsfc="ice:panelGroup" styleClass="dvnStudyListNoStudies" rendered="#{(StudyListingPage.studyListing.mode == 2 and StudyListingPage.studyCount == 0)}">
                  <p><ice:outputText value="Your search #{StudyListingPage.listMessagePrefix} #{StudyListingPage.listMessageContent} returned no results."/></p>
                </div>
                <ice:panelGrid cellpadding="0" cellspacing="0" border="0" columns="3" id="gridPanel2"
                               styleClass="dvnStudyListResultsTop" columnClasses="dvn_StudyListSort, dvn_StudyListTotals, dvnPaginatorWrap"
                               rendered="#{StudyListingPage.renderSort or StudyListingPage.renderScroller}">
                  <div jsfc="ice:panelGroup" id="groupPanel5" rendered="#{StudyListingPage.renderSort}">
                    <ice:selectOneMenu id="dropdown2" valueChangeListener="#{StudyListingPage.sort_action}" onchange="submit();">
                      <f:selectItem itemLabel="Sort By:" itemValue=""/>
                      <f:selectItem itemLabel="- Global ID" itemValue="globalId"/>
                      <f:selectItem itemLabel="- Title" itemValue="title"/>
                      <f:selectItem itemLabel="- Download Count" itemValue="downloadCount"/>
                    </ice:selectOneMenu>
                  </div>
                  <div jsfc="ice:panelGroup" id="groupPanel6">
                    <ice:outputText styleClass="dvn_totalsLabel" value="Studies: "/>
                    <ice:outputText styleClass="dvn_totalsValue" value="#{StudyListingPage.studyCount}"/>
                  </div>
                  <div jsfc="ice:panelGroup" id="groupPanel4" rendered="#{StudyListingPage.renderScroller}">
                    <ice:dataPaginator id="studyListingPaginatorTop" styleClass="dvnPaginatorRight"
                                       for="studyListTable1" paginator="true" partialSubmit="true"
                                       fastStep="3" paginatorMaxPages="4" renderFacetsIfSinglePage="false">
                      <f:facet name="first">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-first.gif" title="First Page"/>
                      </f:facet>
                      <f:facet name="previous">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-previous.gif" title="Previous"/>
                      </f:facet>
                      <f:facet name="next">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-next.gif" title="Next"/>
                      </f:facet>
                      <f:facet name="last">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-last.gif" title="Last Page"/>
                      </f:facet>
                      <f:facet name="fastforward">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-ff.gif" title="Fast Forward"/>
                      </f:facet>
                      <f:facet name="fastrewind">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-fr.gif" title="Fast Rewind"/>
                      </f:facet>
                    </ice:dataPaginator>
                  </div>
                </ice:panelGrid>
                <ice:dataTable rows="10" headerClass="list-header" id="studyListTable1" width="100%"
                               styleClass="dvnStudyListTable" rowClasses="list-row-odd, list-row-even" columnClasses="dvnStudyListTableColumn" value="#{StudyListingPage.studies}" var="studyUI">
                  <ice:column id="column1">
                    <div class="dvnStudyListStudyInfo">
                      <div jsfc="ice:panelGroup" id="groupPanel1">
                        <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyPage.xhtml?studyId=#{studyUI.study.id}&amp;studyListingIndex=#{StudyListingPage.studyListingIndex}" id="hyperlink3">
                          <ice:outputText id="hyperlink3Text" value="#{studyUI.study.title}"/>
                        </ice:outputLink>
                        <ice:outputText id="outputText13" styleClass="dvnStudyListStudyAuthor" value="by #{studyUI.authors}" rendered="#{studyUI.authors != null and studyUI.authors != ''}"/>
                      </div>
                      <!--
                              NO FILES NEED TO GO SOMEWHERE ELSE
                              <div>
                                <ice:graphicImage alt="This study contains no files." rendered="#{!studyUI.files}"
                                                  title="This study contains no files." value="/resources/icon_nofiles.gif" />
                                <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyPage.xhtml?studyId=#{studyUI.study.id}&amp;tab=files&amp;studyListingIndex=#{StudyListingPage.studyListingIndex}" rendered="#{studyUI.files}">
                                  <ice:graphicImage styleClass="vdcNoBorders" alt="This study contains subsettable files." rendered="#{studyUI.subsettable}"
                                                    title="This study contains subsettable files." value="/resources/icon_subsettable.gif" />
                                  <ice:graphicImage styleClass="vdcNoBorders" alt="This study contains only non-subsettable files." rendered="#{!studyUI.subsettable}"
                                                    title="This study contains only non-subsettable files." value="/resources/icon_files.gif" />
                                </ice:outputLink>
                              </div>
                              -->
                      <div jsfc="ice:panelGroup" id="groupPanel2" rendered="#{studyUI.abstracts != null and studyUI.abstracts != ''}">
                        <ice:outputText id="outputText14" styleClass="dvnStudyListTableAbstract" escape="false" value="Abstract: #{studyUI.truncatedAbstracts}"/>
                      </div>
                      <!-- Optional search fields -->
                      <div jsfc="ice:panelGroup" styleClass="dvnStudyListTableOptionalField" rendered="#{!empty StudyListingPage.studyFields[sfc.productionDate] and !empty studyUI.study.productionDate}">
                          <ice:outputText value="Production Date:" styleClass="dvnStudyListTableOptionalFieldLabel"/>
                          <ice:outputText value="#{studyUI.productionDate}"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="dvnStudyListTableOptionalField" rendered="#{!empty StudyListingPage.studyFields[sfc.producerName] and !empty studyUI.producers}">
                          <ice:outputText value="Producer:" styleClass="dvnStudyListTableOptionalFieldLabel"/>
                          <ice:outputText value="#{studyUI.producers}" escape="false"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="dvnStudyListTableOptionalField" rendered="#{!empty StudyListingPage.studyFields[sfc.distributionDate] and !empty studyUI.study.distributionDate}">
                          <ice:outputText value="Distribution Date:" styleClass="dvnStudyListTableOptionalFieldLabel"/>
                          <ice:outputText value="#{studyUI.distributionDate}" escape="false"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="dvnStudyListTableOptionalField" rendered="#{!empty StudyListingPage.studyFields[sfc.distributorName] and !empty studyUI.distributors}">
                          <ice:outputText value="Distributor:" styleClass="dvnStudyListTableOptionalFieldLabel"/>
                          <ice:outputText value="#{studyUI.distributors}" escape="false"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="dvnStudyListTableOptionalField" rendered="#{!empty StudyListingPage.studyFields[sfc.replicationFor] and !empty studyUI.study.replicationFor}">
                          <ice:outputText value="Replication For:" styleClass="dvnStudyListTableOptionalFieldLabel"/>
                          <ice:outputText value="#{studyUI.study.replicationFor}" escape="false"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="dvnStudyListTableOptionalField" rendered="#{!empty StudyListingPage.studyFields[sfc.relatedPublications] and !empty studyUI.relPublications}">
                          <ice:outputText value="Related Publications:" styleClass="dvnStudyListTableOptionalFieldLabel"/>
                          <ice:outputText value="#{studyUI.relPublications}" escape="false"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="dvnStudyListTableOptionalField" rendered="#{!empty StudyListingPage.studyFields[sfc.relatedMaterial] and !empty studyUI.relMaterials}">
                          <ice:outputText value="Related Material:" styleClass="dvnStudyListTableOptionalFieldLabel"/>
                          <ice:outputText value="#{studyUI.relMaterials}" escape="false"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="dvnStudyListTableOptionalField" rendered="#{!empty StudyListingPage.studyFields[sfc.relatedStudies] and !empty studyUI.relStudies}">
                          <ice:outputText value="Related Studies:" styleClass="dvnStudyListTableOptionalFieldLabel"/>
                          <ice:outputText value="#{studyUI.relStudies}" escape="false"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="dvnStudyListTableOptionalField" rendered="#{ !empty studyUI.foundInVariables}">
                          <ice:outputText value="Found In Variables:" styleClass="dvnStudyListTableOptionalFieldLabel"/>
                          <ice:dataTable cellspacing="0" cellpadding="0" width="100%" id="dvDataTable" value="#{studyUI.foundInVariables}" var="dv">
                              <ice:column>
                                  <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/study/VariablePage.xhtml?dvId=#{dv.id}">
                                      <ice:outputText value="#{dv.name}"/>
                                  </ice:outputLink>
                              </ice:column>
                              <ice:column>
                                  <ice:outputText value="#{dv.label}"/>
                              </ice:column>
                              <ice:column>
                                  <ice:outputText value="#{dv.dataTable.studyFile.fileName}"/>
                              </ice:column>
                          </ice:dataTable>
                      </div>
                    </div>
                    <div class="dvnStudyListIDDownloads">
                      <ice:outputText styleClass="dvnStudyListGlobalId" value="#{studyUI.study.globalId}"/>
                      <ice:outputText value="#{studyUI.downloadCount} downloads" rendered="#{studyUI.files and studyUI.downloadCount != 1}"/>
                      <ice:outputText value="#{studyUI.downloadCount} download" rendered="#{studyUI.files and studyUI.downloadCount == 1}"/>
                    </div>
                  </ice:column>
                </ice:dataTable>
                <ice:panelGrid cellpadding="0" cellspacing="0" border="0" columns="2" id="gridPanel22"
                               styleClass="dvnStudyListResultsBottom" columnClasses="dvn_StudyListTotals, dvnPaginatorWrap"
                               rendered="#{StudyListingPage.renderSort or StudyListingPage.renderScroller}">
                  <div jsfc="ice:panelGroup" id="groupPanel55">
                    &nbsp;
                  </div>
                  <div jsfc="ice:panelGroup" id="groupPanel44" rendered="#{StudyListingPage.renderScroller}" styleClass="dvnPaginatorWrap">
                    <ice:dataPaginator id="studyListingPaginatorBottom" styleClass="dvnPaginatorRight"
                                       binding="#{StudyListingPage.paginator}"
                                       for="studyListTable1" paginator="true" partialSubmit="true"
                                       fastStep="3" paginatorMaxPages="4" renderFacetsIfSinglePage="false">
                      <f:facet name="first">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-first.gif" title="First Page"/>
                      </f:facet>
                      <f:facet name="previous">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-previous.gif" title="Previous"/>
                      </f:facet>
                      <f:facet name="next">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-next.gif" title="Next"/>
                      </f:facet>
                      <f:facet name="last">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-last.gif" title="Last Page"/>
                      </f:facet>
                      <f:facet name="fastforward">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-ff.gif" title="Fast Forward"/>
                      </f:facet>
                      <f:facet name="fastrewind">
                        <ice:graphicImage url="/resources/icefaces/dvn_rime/css-images/arrow-fr.gif" title="Fast Rewind"/>
                      </f:facet>
                    </ice:dataPaginator>
                  </div>
                </ice:panelGrid>
              </div>
            </div>
            <div jsfc="ice:panelGroup" id="groupPanel55" styleClass="dvn_sectionPanels" rendered="#{StudyListingPage.renderTree}">
              <div class="dvnCollectionTreeBlock">
                <script>
                    // <![CDATA[
                    jQuery(document).ready(function(){
                        jQuery("a#dvnTreeOpen").click(function(){
                            jQuery(".dvnCollectionTreeBlock").animate({width: "400%"}, 1999 );
                        });
                        jQuery("a#dvnTreeClose").click(function(){
                            jQuery(".dvnCollectionTreeBlock").animate({width: "100%"}, 1999 );
                        });
                    });
                    // ]]>
                </script>
                <div class="dvnCollectionTreeControls">
                  <a id="dvnTreeOpen" name="open">Expand &#187;</a> <a id="dvnTreeClose" name="close">&#171; Close</a>
                </div>
                <ice:tree id="collectionTree"
                          value="#{StudyListingPage.collectionTree}"
                          var="item"
                          hideRootNode="true"
                          hideNavigation="false"
                          imageDir="/dvn/resources/icefaces/dvn_rime/css-images/">
                  <ice:treeNode>
                    <f:facet name="icon">
                      <ice:panelGroup>
                        <h:graphicImage value="#{item.userObject.icon}"/>
                      </ice:panelGroup>
                    </f:facet>
                    <f:facet name="content">
                      <ice:panelGroup>
                          <ice:outputLink value="#{item.userObject.url}">
                            <ice:outputText value="#{item.userObject.text}"/>
                          </ice:outputLink>
                      </ice:panelGroup>
                    </f:facet>
                  </ice:treeNode>
                </ice:tree>
              </div>
            </div>
          </div>
        </div>
        <!-- Main Section ends here -->
      </ice:form>
    </gui:define>
  </gui:composition>
</body>
</html>
