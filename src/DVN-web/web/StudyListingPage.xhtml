<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:gui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:ice="http://www.icesoft.com/icefaces/component"
      xmlns:t="/WEB-INF/tlds/scroller"
      >
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

  </head>

  <body>
    <gui:composition template="/template.xhtml">

      <gui:param name="pageTitle" value="DVN - Search" />

      <gui:define name="body">

        <ice:form id="form1">
          <ice:inputHidden id="vdcId" value="#{VDCRequest.currentVDCId}" />
          <input type="hidden" name="pageName" value="StudyListingPage" />
          <script type="text/javascript">
              // <![CDATA[
              // workaround for issue where f:selectItems does not provide setStyle or setStyleClass wbossons
              function setSearchOptionsClass() {
                  var table = document.getElementById('form1:radioButtonList1'); //form1:radioButtonList1
                  var cells = table.getElementsByTagName('TD');
                  for (var i = 0; i < cells.length; i++) {
                      cells[i].className="vdcSearchOptions";
                  }
              }
              // ]]>
          </script>

          <ice:inputHidden id="studyListingIndex" value="#{StudyListingPage.studyListingIndex}" />

          <!-- Main Section starts here -->
          <div id="dvn_mainSection">

            <!-- Search Section starts here -->
            <div class="dvn_searchblock">
              <div class="dvn_searchBoxContent">
                <div class="dvn_searchTitle"><a title="" name="search">Search</a></div>
                <fieldset>
                  <label for="options">
                    <ice:selectOneMenu id="dropdown1" value="#{StudyListingPage.searchField}">
                      <f:selectItem itemLabel="Cataloging Information" itemValue="any" />
                      <f:selectItem itemLabel="- Author" itemValue="authorName" />
                      <f:selectItem itemLabel="- Title" itemValue="title" />
                      <f:selectItem itemLabel="- Global ID" itemValue="globalId" />
                      <f:selectItem itemLabel="Variable Information" itemValue="variable" />
                    </ice:selectOneMenu>
                  </label>
                  <label for="search">
                    <ice:inputText onkeypress="if (window.event) return processEvent('', 'form1:search'); else return processEvent(event, 'form1:search');" id="textField2" value="#{StudyListingPage.searchValue}" />
                  </label>
                  <ice:outputLabel for="filter" rendered="#{StudyListingPage.renderSearchResultsFilter}" >
                    <ice:selectBooleanCheckbox value="#{StudyListingPage.searchResultsFilter}" />
                    <span><ice:outputText value="within these results" /></span>
                  </ice:outputLabel>
                  <ice:outputLabel  for="filter" rendered="#{StudyListingPage.renderSearchCollectionFilter}" >
                    <ice:selectBooleanCheckbox value="#{StudyListingPage.searchCollectionFilter}" />
                    <span><ice:outputText value="within this collection" /></span>
                  </ice:outputLabel>
                  <label for="button">
                    <ice:commandButton id="search" value="Go" action="#{StudyListingPage.search_action}" />
                  </label>
                </fieldset>
                <div class="dvn_searchLinks">
                  <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/AdvSearchPage.xhtml">
                    <ice:outputText value="Advanced Search" />
                  </ice:outputLink>
                  &#160; | &#160;
                  <ice:outputLink value="http://thedata.org/guides/users/search/tips" target="_blank">
                    <ice:outputText value="Tips"/>
                  </ice:outputLink>
                </div>
              </div>
            </div>

            <script type="text/javascript">
                onLoad=setSearchOptionsClass();
            </script>
            <!-- Search Section ends here -->

    <!-- Start Search Results (with side panel, if available) -->
            <div jsfc="ice:panelGroup"  styleClass="#{ (StudyListingPage.renderTree) ? 'dvn_section dvn_overflow' : 'dvn_section'}" >
              <div jsfc="ice:panelGroup"  styleClass="#{ (StudyListingPage.renderTree) ? 'dvn_sectionContent' : 'dvn_sectionContentNoPanels'}" >

                <div>
                  <ice:outputText value="This is where search terms should go..." />

                  <ice:outputText value="#{StudyListingPage.subListHeader}" />

                  <ice:outputText id="listMessagePrefix" value="#{StudyListingPage.listMessagePrefix}" />
                  <ice:outputText id="listMessageContent" styleClass="warnMessage" value="#{StudyListingPage.listMessageContent}" />
                  <ice:outputText id="listMessageSuffix" value="#{StudyListingPage.listMessageSuffix}" />
                </div>

                <div jsfc="ice:panelGroup" style="padding: .5em .25em; border: 1px solid gold; border-width: 1px 1px 0 1px; font-weight: bold;">
                  <ice:outputText value="#{StudyListingPage.collectionName}" />
                </div>

                <div style="border: 1px solid gold;">

                  <ice:panelGrid cellpadding="0" cellspacing="0" border="0" columns="3" id="gridPanel2" width="100%"
                                 styleClass="vdcSResultsTop" rendered="#{StudyListingPage.renderSort or StudyListingPage.renderScroller}"
                                 style="border-bottom: 1px solid gold;">
                    <div jsfc="ice:panelGroup" id="groupPanel5" rendered="#{StudyListingPage.renderSort}">
                      <ice:selectOneMenu id="dropdown2" valueChangeListener="#{StudyListingPage.sort_action}" onchange="submit();">
                        <f:selectItem itemLabel="Sort By:" itemValue="" />
                        <f:selectItem itemLabel="- Study ID" itemValue="studyId" />
                        <f:selectItem itemLabel="- Title" itemValue="title" />
                      </ice:selectOneMenu>
                    </div>

                    <div jsfc="ice:panelGroup" id="groupPanel6" style="text-align: right;">
                      <ice:outputText value="Studies: #{StudyListingPage.studyCount}" />
                    </div>

                    <div jsfc="ice:panelGroup"  id="groupPanel4" rendered="#{StudyListingPage.renderScroller}">
                      <t:scroller binding="#{StudyListingPage.scroller}" for="dataTable1" actionListener="#{StudyListingPage.scroll_action}">
                        <f:facet name="previous">
                          <ice:graphicImage id="scrollBack" value="/resources/arrow-left.gif" styleClass="vdcNoBorders" />
                        </f:facet>
                        <f:facet name="next">
                          <ice:graphicImage id="scrollNext" value="/resources/arrow-right.gif" styleClass="vdcNoBorders" />
                        </f:facet>
                      </t:scroller>
                    </div>
                  </ice:panelGrid>

                  <ice:dataTable binding="#{StudyListingPage.studyTable}" rows="10" headerClass="list-header" id="dataTable1" width="100%"
                                 styleClass="vdcSResultsTable" rowClasses="list-row-odd, list-row-even" columnClasses="vdcSResultsList" value="#{StudyListingPage.studies}" var="studyUI">
                    <ice:column id="column1">
                      <div style="float: left; width: 77%; background: inherit; font-size: 80% !important;">
                        <div jsfc="ice:panelGroup" id="groupPanel1">
                          <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyPage.xhtml?studyId=#{studyUI.study.id}&amp;studyListingIndex=#{StudyListingPage.studyListingIndex}" id="hyperlink3">
                            <ice:outputText id="hyperlink3Text" value="#{studyUI.study.title}" />
                          </ice:outputLink>

                          <ice:outputText id="outputText13" value="by #{studyUI.authors}" rendered="#{studyUI.authors != null and studyUI.authors != ''}" />
                        </div>
                        <!--
                                <div>
                                  <ice:graphicImage alt="This study contains no files." rendered="#{!studyUI.files}"
                                                    title="This study contains no files." value="/resources/icon_nofiles.gif" />
                                  <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyPage.xhtml?studyId=#{studyUI.study.id}&amp;tab=files&amp;studyListingIndex=#{StudyListingPage.studyListingIndex}" rendered="#{studyUI.files}">
                                    <ice:graphicImage styleClass="vdcNoBorders" alt="This study contains subsettable files." rendered="#{studyUI.subsettable}"
                                                      title="This study contains subsettable files." value="/resources/icon_subsettable.gif" />
                                    <ice:graphicImage styleClass="vdcNoBorders" alt="This study contains only non-subsettable files." rendered="#{!studyUI.subsettable}"
                                                      title="This study contains only non-subsettable files." value="/resources/icon_files.gif" />
                                  </ice:outputLink>
                                </div>
                                -->
                        <div jsfc="ice:panelGroup" id="groupPanel2" rendered="#{studyUI.abstracts != null and studyUI.abstracts != ''}" >
                          <ice:outputText id="outputText14" styleClass="vdcAbstractSResults" escape="false" value="Abstract: #{studyUI.truncatedAbstracts}" />

                          <!-- <div jsfc="ice:panelGroup"  styleClass="vdcAbstractSResults">
                                        <ice:outputText  id="outputText14" escape="false" value="#{studyUI.truncatedAbstracts}" />
                                    </div> -->
                        </div>

                        <!-- Optional search fields
                                <div jsfc="ice:panelGroup" id="groupPanel7" rendered="#{studyUI.study.productionDate != null and studyUI.study.productionDate != ''}">
                                    <ice:outputText id="outputText15" styleClass="vdcSResultsField" value="Production Date:" />
                                    <ice:outputText id="outputText11" value="#{studyUI.study.productionDate}" />
                                </div>
                                <div jsfc="ice:panelGroup"  rendered="#{!empty StudyListingPage.studyFields[sfc.producerName]  and !empty studyUI.producers}">
                                    <ice:outputText value="Producer:" styleClass="vdcSResultsField" />
                                    <ice:outputText value="#{studyUI.producers}" escape="false" />
                                </div>
                                <div jsfc="ice:panelGroup"  rendered="#{!empty StudyListingPage.studyFields[sfc.distributionDate]  and !empty studyUI.study.distributionDate}">
                                    <ice:outputText value="Distribution Date:" styleClass="vdcSResultsField" />
                                    <ice:outputText value="#{studyUI.study.distributionDate}" escape="false" />
                                </div>
                                <div jsfc="ice:panelGroup"  rendered="#{!empty StudyListingPage.studyFields[sfc.distributorName]  and !empty studyUI.distributors}">
                                    <ice:outputText value="Distributor:" styleClass="vdcSResultsField" />
                                    <ice:outputText value="#{studyUI.distributors}" escape="false" />
                                </div>
                                <div jsfc="ice:panelGroup"  rendered="#{!empty StudyListingPage.studyFields[sfc.replicationFor]  and !empty studyUI.study.replicationFor}">
                                    <ice:outputText value="Replication For:" styleClass="vdcSResultsField" />
                                    <ice:outputText value="#{studyUI.study.replicationFor}" escape="false" />
                                </div>
                                <div jsfc="ice:panelGroup"  rendered="#{!empty StudyListingPage.studyFields[sfc.relatedPublications]  and !empty studyUI.relPublications}">
                                    <ice:outputText value="Related Publications:" styleClass="vdcSResultsField" />
                                    <ice:outputText value="#{studyUI.relPublications}" escape="false" />
                                </div>
                                <div jsfc="ice:panelGroup"  rendered="#{!empty StudyListingPage.studyFields[sfc.relatedMaterial]  and !empty studyUI.relMaterials}">
                                    <ice:outputText value="Related Material:" styleClass="vdcSResultsField" />
                                    <ice:outputText value="#{studyUI.relMaterials}" escape="false" />
                                </div>
                                <div jsfc="ice:panelGroup"  rendered="#{!empty StudyListingPage.studyFields[sfc.relatedStudies]  and !empty studyUI.relStudies}">
                                    <ice:outputText value="Related Studies:" styleClass="vdcSResultsField" />
                                    <ice:outputText value="#{studyUI.relStudies}" escape="false" />
                                </div>

                                <div jsfc="ice:panelGroup"  rendered="#{ !empty studyUI.foundInVariables}">
                                    <ice:outputText value="Found In Variables:" styleClass="vdcSResultsField" />
                                    <ice:dataTable id="dvDataTable" value="#{studyUI.foundInVariables}" var="dv" width="100%">
                                        <ice:column>
                                            <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/study/VariablePage.xhtml?dvId=#{dv.id}">
                                                <ice:outputText value="#{dv.name}" />
                                            </ice:outputLink>
                                        </ice:column>
                                        <ice:column>
                                            <ice:outputText value="#{dv.label}" />
                                        </ice:column>
                                        <ice:column>
                                            <ice:outputText value="#{dv.dataTable.studyFile.fileName}" />
                                        </ice:column>
                                    </ice:dataTable>
                                </div>
                                -->
                      </div>

                      <div style="float: right; padding: 0 10px; border-left: 1px solid green;">
                        <ice:outputText styleClass="dvn_SResultsGlobalId" value="#{studyUI.study.globalId}" />

                        <ice:outputText value="#{studyUI.downloadCount} downloads" rendered="#{studyUI.files and studyUI.downloadCount != 1}" />
                        <ice:outputText value="#{studyUI.downloadCount} download" rendered="#{studyUI.files and studyUI.downloadCount == 1}" />
                      </div>

                    </ice:column>
                  </ice:dataTable>

                  <ice:panelGrid cellpadding="0" cellspacing="0" border="0" columns="2" id="gridPanel22" width="100%"
                                 styleClass="vdcSResultsTop" rendered="#{StudyListingPage.renderSort or StudyListingPage.renderScroller}"
                                 style="border-top: 1px solid gold;">
                    <div jsfc="ice:panelGroup"  id="groupPanel55" rendered="#{StudyListingPage.renderSort}">

                    </div>


                    <div jsfc="ice:panelGroup"  id="groupPanel44" rendered="#{StudyListingPage.renderScroller}">
                      <t:scroller binding="#{StudyListingPage.scroller2}" for="dataTable1" actionListener="#{StudyListingPage.scroll_action}">
                        <f:facet name="previous">
                          <ice:graphicImage id="scrollBack2" value="/resources/arrow-left.gif" styleClass="vdcNoBorders" />
                        </f:facet>
                        <f:facet name="next">
                          <ice:graphicImage id="scrollNext2" value="/resources/arrow-right.gif" styleClass="vdcNoBorders" />
                        </f:facet>
                      </t:scroller>
                    </div>
                  </ice:panelGrid>


                </div>
              </div>
              <div jsfc="ice:panelGroup" id="groupPanel55" styleClass="dvn_sectionPanels">
                <!--
            <ice:outputText value="This is where the collection tree should go... There also needs to be a render on the style class dvn_sectionPanels. The render on the style class for the dvn_sectionContent (the div on the right) isnt working at the moment." />
            -->
                <ice:tree id="collectionTree"
                          value="#{StudyListingPage.collectionTree}"
                          var="item"
                          hideRootNode="true"
                          hideNavigation="false"
                          rendered="#{StudyListingPage.renderTree}" >
                  <ice:treeNode>
                    <f:facet name="icon">
                      <ice:panelGroup style="display: inline">
                        <h:graphicImage value="#{item.userObject.icon}"/>
                      </ice:panelGroup>
                    </f:facet>
                    <f:facet name="content">
                      <ice:panelGroup style="display: inline">
                        <ice:outputLink value="#{item.userObject.url}">
                          <ice:outputText value="#{item.userObject.text}" />
                        </ice:outputLink>
                      </ice:panelGroup>
                    </f:facet>
                  </ice:treeNode>
                </ice:tree>
              </div>
            </div>

          </div>
          <!-- Main Section ends here -->

        </ice:form>
      </gui:define>
    </gui:composition>
  </body>
</html>
