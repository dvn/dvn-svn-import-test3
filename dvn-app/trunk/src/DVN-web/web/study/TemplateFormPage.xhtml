<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:ice="http://www.icesoft.com/icefaces/component"
      xmlns:dvn="/WEB-INF/tlds/dvn-components">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
  <ui:composition template="/template.xhtml">
    <ui:param name="pageTitle" value="#{bundlePageInfo.editTemplateTitle} - #{VDCRequest.dataversePageTitle}"/>
    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="templateId" value="#{TemplateFormPage.templateId}"/>
            <f:viewParam name="studyVersionId" value="#{TemplateFormPage.studyVersionId}"/>
            <f:viewParam name="studyListingIndex" value="#{VDCRequest.studyListingIndex}"/>          
            <f:event type="preRenderView" listener="#{TemplateFormPage.preRenderView}" />
        </f:metadata>  
    </ui:define>
    <ui:define name="body">
      <f:loadBundle basename="EditStudyBundle" var="editstudybundle"/>
      <dvn:inlinehelpsupport writeHelpDiv="true" writeTipDiv="true" rendered="true"/>
      <ice:form id="templateForm">
        <ice:inputHidden id="vdcId" value="#{VDCRequest.currentVDCId}"/>
        <input type="hidden" name="pageName" value="TemplateFormPage"/>
         <div class="dvn_section">
          <div jsfc="ice:panelGroup" styleClass="dvnMsgBlockRound dvnInformationMessage">
            <div class="dvnMsgBlockContainer">
              <ice:outputText value="#{bundlePageInfo.editTemplateHelp}" escape="false"/>
            </div>
          </div>
          <div class="dvn_sectionTitle">
            <ice:outputText value="#{TemplateFormPage.template.metadata.title}"/>
          </div>
          <div class="dvn_sectionBoxNoBorders">
            <!-- validation errors occurred? -->
            <div id="messagePanel" class="errorMessage">
              <ice:outputText value="Please check messages below" rendered="#{!empty facesContext.maximumSeverity}"/>
            </div>
            <div id="groupPanel10" class="vdcTextRight dvnFormMargin">
              <ice:commandButton id="button1" value="Save" action="#{TemplateFormPage.save}"/>
              <ice:commandButton immediate="true" id="button2" value="Cancel" action="#{TemplateFormPage.cancel}"/>
            </div>
            <div panelLayout="flow" class="vdcStudyTemplateFormTable">
              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2">
                  <ice:column>
                    <ice:outputText value="Template Name: "/>
                  </ice:column>
                  <ice:column>
                    <ice:inputText id="template_name" size="45" value='#{TemplateFormPage.template.name}' required='true' requiredMessage='Template name is required.'/>
                    <ice:message styleClass="errorMessage" for="template_name"/>
                  </ice:column>
              </ice:panelGrid>

              <div id="groupPanel9" class="vdcStudyInfoHeader">
                <ice:outputText id="outputText26" value="Citation Information"/>
              </div>

              <!-- TITLE -->
              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable" columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <dvn:inlinehelp helpMessage="#{editstudybundle.titleHelp}" linkText="#{editstudybundle.titleLabel}" heading="#{editstudybundle.titleHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage id="image39" value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.title].required}"/>
                  <ice:graphicImage id="image40" value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.title].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText binding="#{TemplateFormPage.inputTitle}" id="input_title" size="90" value="#{TemplateFormPage.template.metadata.title}"/>
                  <ice:message styleClass="errorMessage" for="input_title"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                    styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.subTitle].templateField.fieldInputLevelString}"
                    columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">                  
                  <ice:selectOneMenu immediate="false"    
                                     valueChangeListener="#{TemplateFormPage.changeFieldInputValue}"
                                        value="#{TemplateFormPage.studyMap[sfc.subTitle].templateField.fieldInputLevelString}">
                        <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        <f:attribute name="fieldName" value="subTitle" />
                   </ice:selectOneMenu>                  
                  <dvn:inlinehelp helpMessage="#{editstudybundle.subtitleHelp}" linkText="#{editstudybundle.subtitleLabel}" heading="#{editstudybundle.subtitleHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.subTitle].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.subTitle].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_subtitle" size="90" value="#{TemplateFormPage.template.metadata.subTitle}" />
                  <ice:message styleClass="errorMessage" for="input_subtitle"/>
                </ice:column>
              </ice:panelGrid>

              <!-- OTHER IDS -->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable" rowClasses="#{TemplateFormPage.otherIdLevel}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableOtherIds}"
                                 value="#{TemplateFormPage.template.metadata.studyOtherIds}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField"> 
                       <ice:selectOneMenu immediate="false" 
                                        value="#{TemplateFormPage.studyMap[sfc.otherId].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}"
                                        rendered ="#{TemplateFormPage.dataTableOtherIds.rowIndex==0}">
                           <f:attribute name="fieldName" value="otherId" />
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                    </ice:selectOneMenu> 
                        <dvn:inlinehelp helpMessage="#{editstudybundle.otheridHelp}" linkText="#{editstudybundle.otheridLabel}" heading="#{editstudybundle.otheridHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.otherIdLevel=='required'}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.otherIdLevel=='recommended'}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div class="vdcEditStudyFieldFloatWrap">
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 #{TemplateFormPage.studyMap[sfc.otherId].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.otheridHelp}" linkText="#{editstudybundle.otheridLabel}" heading="#{editstudybundle.otheridHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" binding="#{TemplateFormPage.inputOtherId}" id="input_otherId" value="#{currentRow.otherId}" />
                          <ice:message styleClass="errorMessage" for="input_otherId"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.otherIdAgency].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.otherAgencyHelp}" linkText="#{editstudybundle.otherAgencyLabel}" heading="#{editstudybundle.otherAgencyHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" binding="#{TemplateFormPage.inputOtherIdAgency}" validator="#{TemplateFormPage.validateStudyOtherId}"
                                         id="input_otherIdAgency" value="#{currentRow.agency}" />
                          <ice:message styleClass="errorMessage" for="input_otherIdAgency"/>
                        </div>
                      </div>
                    </ice:column>
                    <ice:column id="groupPanel61">
                      <ice:commandButton  partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="True" rendered="#{TemplateFormPage.dataTableOtherIds.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <!-- Authors -->
              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable" rowClasses="#{TemplateFormPage.authorInputLevel}" value="dummy_datatable" >
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableAuthors}"
                                 value="#{TemplateFormPage.template.metadata.studyAuthors}" var="currentAuthor">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="false"  
                                        value="#{TemplateFormPage.studyMap[sfc.authorName].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}"
                                        rendered ="#{TemplateFormPage.dataTableAuthors.rowIndex==0}">
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                           <f:attribute name="fieldName" value="authorName" />
                        </ice:selectOneMenu> 
                        <dvn:inlinehelp helpMessage="#{editstudybundle.authorHelp}" linkText="#{editstudybundle.authorLabel}" heading="#{editstudybundle.authorHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.authorInputLevel=='required'}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.authorInputLevel=='recommended'}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div class="vdcEditStudyFieldFloatWrap">
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 #{TemplateFormPage.studyMap[sfc.authorName].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.authorNameHelp}" linkText="#{editstudybundle.authorNameLabel}" heading="#{editstudybundle.authorNameHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText id="input_authorName"
                                         value="#{currentAuthor.name}"
                                         size="45"
                                         maxlength="255"
                                         binding="#{TemplateFormPage.inputAuthorName}"
                                         />
                          <ice:outputText value="(firstName LastName)"/>
                          <ice:message styleClass="errorMessage" for="input_authorName"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 #{TemplateFormPage.studyMap[sfc.authorAffiliation].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.authorAffiliationHelp}" linkText="#{editstudybundle.authorAffiliationLabel}" heading="#{editstudybundle.authorAffiliationHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText id="input_authorAffiliation" size="45" maxlength="255"
                                         binding="#{TemplateFormPage.inputAuthorAffiliation}"
                                         value="#{currentAuthor.affiliation}"
                                         validator="#{TemplateFormPage.validateStudyAuthor}"                             
                                         styleClass="formHtmlEnabled">
                            <f:validator validatorId="XhtmlValidator"/>
                          </ice:inputText>
                          <ice:message styleClass="errorMessage" for="input_authorAffiliation"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 #{TemplateFormPage.studyMap[sfc.authorAffiliation].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.authorIDValueHelp}" linkText="#{editstudybundle.authorIDValueLabel}" heading="#{editstudybundle.authorIDValueHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText id="input_authorIDValue" size="45" maxlength="255"
                                         binding="#{TemplateFormPage.inputAuthorIDValue}"
                                         value="#{currentAuthor.idValue}"
                                         validator="#{TemplateFormPage.validateStudyAuthor}"                                       
                                >
                          </ice:inputText>
                          <ice:message styleClass="errorMessage" for="input_authorAffiliation"/>
                        </div>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableAuthors.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <!--Producers-->
              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable" rowClasses="#{TemplateFormPage.producerInputLevel}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableProducers}"
                                 value="#{TemplateFormPage.template.metadata.studyProducers}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">
                         <ice:selectOneMenu immediate="false" 
                                        value="#{TemplateFormPage.studyMap[sfc.producerName].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}"
                                        rendered ="#{TemplateFormPage.dataTableProducers.rowIndex==0}">
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                            <f:attribute name="fieldName" value="producerName" />
                        </ice:selectOneMenu>                          
                         <dvn:inlinehelp helpMessage="#{editstudybundle.producerHelp}" linkText="#{editstudybundle.producerLabel}" heading="#{editstudybundle.producerHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.producerInputLevel=='required'}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.producerInputLevel=='recommended'}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div class="vdcEditStudyFieldFloatWrap">
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.producerName].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.producerHelp}" linkText="#{editstudybundle.producerLabel}" heading="#{editstudybundle.producerHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" binding="#{TemplateFormPage.inputProducerName}" id="input_producerName" value="#{currentRow.name}" size="45" 
                                         />
                          <ice:message styleClass="errorMessage" for="input_producerName"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.producerAbbreviation].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.producerAbbreviationHelp}" linkText="#{editstudybundle.producerAbbreviationLabel}" heading="#{editstudybundle.producerAbbreviationHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" validator="#{TemplateFormPage.validateStudyProducer}" binding="#{TemplateFormPage.inputProducerAbbreviation}" 
                                         id="input_producerAbbreviation" value="#{currentRow.abbreviation}" />
                          <ice:message styleClass="errorMessage" for="input_producerAbbreviation"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.producerAffiliation].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.producerAffiliationHelp}" linkText="#{editstudybundle.producerAffiliationLabel}" heading="#{editstudybundle.producerAffiliationHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" validator="#{TemplateFormPage.validateStudyProducer}" binding="#{TemplateFormPage.inputProducerAffiliation}" 
                                         id="input_producerAffiliation" size="45" value="#{currentRow.affiliation}" 
                                         styleClass="formHtmlEnabled">
                            <f:validator validatorId="XhtmlValidator"/>
                          </ice:inputText>
                          <ice:message styleClass="errorMessage" for="input_producerAffiliation"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.producerURL].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.producerURLHelp}" linkText="#{editstudybundle.producerURLLabel}" heading="#{editstudybundle.producerURLHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText id="input_producerURL"
                                         validator="#{TemplateFormPage.validateStudyProducer}"
                                         binding="#{TemplateFormPage.inputProducerUrl}"
                                         value="#{currentRow.url}"
                                         size="45"
                                         maxlength="255"
                                         >
                            <f:validator validatorId="UrlValidator"/>
                          </ice:inputText>
                          <ice:outputText value="(http://example-domain.edu/)"/>
                          <ice:message styleClass="errorMessage" for="input_producerURL"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField  #{TemplateFormPage.studyMap[sfc.producerLogo].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.producerLogoHelp}" linkText="#{editstudybundle.producerLogoLabel}" heading="#{editstudybundle.producerLogoHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText id="input_producerLogo"
                                         binding="#{TemplateFormPage.inputProducerLogo}"
                                         validator="#{TemplateFormPage.validateStudyProducer}"
                                         value="#{currentRow.logo}"
                                         size="45"
                                         maxlength="255"
                                         >
                            <f:validator validatorId="UrlValidator"/>
                          </ice:inputText>
                          <ice:outputText value="(http://example-domain.edu/images/)"/>
                          <ice:message styleClass="errorMessage" for="input_producerLogo"/>
                        </div>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableProducers.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.productionDate].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" 
                                        value="#{TemplateFormPage.studyMap[sfc.productionDate].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="productionDate" />
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.productionDateHelp}" linkText="#{editstudybundle.productionDateLabel}" heading="#{editstudybundle.productionDateHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.productionDate].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.productionDate].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_productionDate" styleClass="formDateFormat" value="#{TemplateFormPage.template.metadata.productionDate}" 
                                 >
                  </ice:inputText>
                  <ice:outputText value=" (YYYY or YYYY-MM or YYYY-MM-DD)"/>
                  <ice:message styleClass="errorMessage" for="input_productionDate"><f:param name="x" value="Production Date:"/> </ice:message>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" width="100%"
                    styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.productionPlace].templateField.fieldInputLevelString}"
                    columnClasses="vdcEditStudyCol1, vdcEditStudyCol2" columns="2">
                <ice:column styleClass="vdcEditStudyField">                  
                  <ice:selectOneMenu immediate="false" 
                                        value="#{TemplateFormPage.studyMap[sfc.productionPlace].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="productionPlace" />
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.productionPlaceHelp}" linkText="#{editstudybundle.productionPlaceLabel}" heading="#{editstudybundle.productionPlaceHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.productionPlace].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.productionPlace].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_productionPlace" size="45" value="#{TemplateFormPage.template.metadata.productionPlace}" 
                                 />
                  <ice:message styleClass="errorMessage" for="input_productionPlace"/>
                </ice:column>
              </ice:panelGrid>

              <!-- Software -->
              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable" rowClasses="#{TemplateFormPage.softwareInputLevel}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableSoftware}"
                                 value="#{TemplateFormPage.template.metadata.studySoftware}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">                      
                        <ice:selectOneMenu immediate="false"
                                        value="#{TemplateFormPage.studyMap[sfc.softwareName].templateField.fieldInputLevelString}"
                                        rendered ="#{TemplateFormPage.dataTableSoftware.rowIndex==0}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="softwareName" />
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{editstudybundle.softwareNameHelp}" linkText="#{editstudybundle.softwareNameLabel}" heading="#{editstudybundle.softwareNameHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.softwareInputLevel=='required'}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.softwareInputLevel=='recommended'}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div class="vdcEditStudyFieldFloatWrap">
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 #{TemplateFormPage.studyMap[sfc.softwareName].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.softwareNameHelp}" linkText="#{editstudybundle.softwareNameLabel}" heading="#{editstudybundle.softwareNameHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" binding="#{TemplateFormPage.inputSoftwareName}" id="input_softwareName" size="45" value="#{currentRow.name}"/>
                          <ice:message styleClass="errorMessage" for="input_softwareName"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.softwareVersion].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.softwareVersionHelp}" linkText="#{editstudybundle.softwareVersionLabel}" heading="#{editstudybundle.softwareVersionHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" binding="#{TemplateFormPage.inputSoftwareVersion}" validator="#{TemplateFormPage.validateStudySoftware}" id="input_softwareVersion" value="#{currentRow.softwareVersion}" 
                                         />
                          <ice:message styleClass="errorMessage" for="input_softwareVersion"/>
                        </div>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableSoftware.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                            styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.fundingAgency].templateField.fieldInputLevelString}"
                            columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false"  
                                        value="#{TemplateFormPage.studyMap[sfc.fundingAgency].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="fundingAgency" />
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.fundingAgencyHelp}" linkText="#{editstudybundle.fundingAgencyLabel}" heading="#{editstudybundle.fundingAgencyHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.fundingAgency].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.fundingAgency].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_fundingAgency" size="45" value="#{TemplateFormPage.template.metadata.fundingAgency}" 
                                 />
                  <ice:message styleClass="errorMessage" for="input_fundingAgency"/>
                </ice:column>
              </ice:panelGrid>

              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable" rowClasses="#{TemplateFormPage.grantInputLevel}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableGrants}"
                                 value="#{TemplateFormPage.template.metadata.studyGrants}" var="currentRow" width="100%">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="false" 
                                        value="#{TemplateFormPage.studyMap[sfc.grantNumber].templateField.fieldInputLevelString}"
                                        rendered ="#{TemplateFormPage.dataTableGrants.rowIndex==0}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="grantNumber" />
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{editstudybundle.grantNumberHelp}" linkText="#{editstudybundle.grantNumberLabel}" heading="#{editstudybundle.grantNumberHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.grantInputLevel=='required'}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.grantInputLevel=='recommended'}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.grantNumber].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.grantNumberHelp}" linkText="#{editstudybundle.grantNumberLabel}" heading="#{editstudybundle.grantNumberHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" immediate="true" binding="#{TemplateFormPage.inputGrantNumber}" id="input_grantNumber" size="45" value="#{currentRow.number}" 
                                        />
                          <ice:message styleClass="errorMessage" for="input_grantNumber"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.grantNumberAgency].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.grantingAgencyHelp}" linkText="#{editstudybundle.grantingAgencyLabel}" heading="#{editstudybundle.grantingAgencyHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText  maxlength="255" immediate="true" binding="#{TemplateFormPage.inputGrantAgency}" validator="#{TemplateFormPage.validateStudyGrant}" id="input_grantNumberAgency" size="45" value="#{currentRow.agency}" 
                                          />
                          <ice:message styleClass="errorMessage" for="input_grantNumberAgency"/>
                        </div>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableGrants.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable" rowClasses="#{TemplateFormPage.distributorInputLevel}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableDistributors}"
                                 value="#{TemplateFormPage.template.metadata.studyDistributors}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.distributorName].templateField.fieldInputLevelString}"
                                        rendered ="#{TemplateFormPage.dataTableDistributors.rowIndex==0}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="distributorName" />
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{editstudybundle.distributorHelp}" linkText="#{editstudybundle.distributorLabel}" heading="#{editstudybundle.distributorHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.distributorInputLevel=='required'}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.distributorInputLevel=='recommended'}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div styleClass="vdcEditStudyFieldFloatWrap">
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 #{TemplateFormPage.studyMap[sfc.distributorName].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.distributorHelp}" linkText="#{editstudybundle.distributorLabel}" heading="#{editstudybundle.distributorHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" binding="#{TemplateFormPage.inputDistributorName}" id="input_distributorName" value="#{currentRow.name}" size="45" 
                                         />
                          <ice:message styleClass="errorMessage" for="input_distributorName"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.distributorAbbreviation].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.distributorAbbreviationHelp}" linkText="#{editstudybundle.distributorAbbreviationLabel}" heading="#{editstudybundle.distributorAbbreviationHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" validator="#{TemplateFormPage.validateStudyDistributor}" binding="#{TemplateFormPage.inputDistributorAbbreviation}" id="input_distributorAbbreviation" value="#{currentRow.abbreviation}"  
                                         />
                          <ice:message styleClass="errorMessage" for="input_distributorAbbreviation"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.distributorAffiliation].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.distributorAffiliationHelp}" linkText="#{editstudybundle.distributorAffiliationLabel}" heading="#{editstudybundle.distributorAffiliationHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" id="input_distributorAffiliation" validator="#{TemplateFormPage.validateStudyDistributor}" binding="#{TemplateFormPage.inputDistributorAffiliation}" size="45"
                                         value="#{currentRow.affiliation}"
                                         styleClass="formHtmlEnabled">
                            <f:validator validatorId="XhtmlValidator"/>
                          </ice:inputText>
                          <ice:message styleClass="errorMessage" for="input_distributorAffiliation"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.distributorURL].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.distributorURLHelp}" linkText="#{editstudybundle.distributorURLLabel}" heading="#{editstudybundle.distributorURLHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText id="input_distributorURL"
                                         validator="#{TemplateFormPage.validateStudyDistributor}"
                                         binding="#{TemplateFormPage.inputDistributorUrl}"
                                         value="#{currentRow.url}"
                                         size="45"
                                         maxlength="255"
                                         >
                            <f:validator validatorId="UrlValidator"/>
                          </ice:inputText>
                          <ice:outputText value="(http://example-domain.edu/)"/>
                          <ice:message styleClass="errorMessage" for="input_distributorURL"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField  #{TemplateFormPage.studyMap[sfc.distributorLogo].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.distributorLogoHelp}" linkText="#{editstudybundle.distributorLogoLabel}" heading="#{editstudybundle.distributorLogoHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText binding="#{TemplateFormPage.inputDistributorLogo}" id="input_distributorLogo"
                                         validator="#{TemplateFormPage.validateStudyDistributor}"
                                         value="#{currentRow.logo}"
                                         size="45"
                                         maxlength="255"
                                         >
                            <f:validator validatorId="UrlValidator"/>
                          </ice:inputText>
                          <ice:outputText value="(http://example-domain.edu/images/)"/>
                          <ice:message styleClass="errorMessage" for="input_distributorLogo"/>
                        </div>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableDistributors.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.distributorInputLevel}" columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField #{TemplateFormPage.distributorInputLevel}">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.distributorContact].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="distributorContact" />
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.distributorContactHelp}" linkText="#{editstudybundle.distributorContactLabel}" heading="#{editstudybundle.distributorContactHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.distributorContact].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.distributorContact].recommended}"/>
                </ice:column>
                <ice:column styleClass="vdcEditStudyFieldFloatWrap">
                  <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 #{TemplateFormPage.studyMap[sfc.distributorContact].templateField.fieldInputLevelString}">
                    <dvn:inlinehelp helpMessage="#{editstudybundle.distributorContactHelp}" linkText="#{editstudybundle.distributorContactLabel}" heading="#{editstudybundle.distributorContactHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText binding ="#{TemplateFormPage.inputDistributorContact}" id="input_distributorContact" size="45" value="#{TemplateFormPage.template.metadata.distributorContact}"  />
                    <ice:message styleClass="errorMessage" for="input_distributorContact"/>
                  </div>
                  <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.distributorContactAffiliation].templateField.fieldInputLevelString}">
                    <dvn:inlinehelp helpMessage="#{editstudybundle.distributorContactAffiliationHelp}" linkText="#{editstudybundle.distributorContactAffiliationLabel}" heading="#{editstudybundle.distributorContactAffiliationHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText id="distributorContactAffiliation"
                                   binding ="#{TemplateFormPage.inputDistributorContactAffiliation}"
                                  value="#{TemplateFormPage.template.metadata.distributorContactAffiliation}"
                                   validator="#{TemplateFormPage.validateDistributorContact}"
                                   styleClass="formHtmlEnabled">
                      <f:validator validatorId="XhtmlValidator"/>
                    </ice:inputText>
                    <ice:message styleClass="errorMessage" for="distributorContactAffiliation"/>
                  </div>
                  <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.distributorContactEmail].templateField.fieldInputLevelString}">
                    <dvn:inlinehelp helpMessage="#{editstudybundle.distributorContactEmailHelp}" linkText="#{editstudybundle.distributorContactEmailLabel}" heading="#{editstudybundle.distributorContactEmailHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText  binding ="#{TemplateFormPage.inputDistributorContactEmail}" id="input_distributorContactEmail" size="45" 
                                    value="#{TemplateFormPage.template.metadata.distributorContactEmail}" 
                                    />
                    <ice:message styleClass="errorMessage" for="input_distributorContactEmail"/>
                  </div>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.distributionDate].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <div jsfc="ice:panelGroup" id="groupPanel49" styleClass="vdcEditStudyField #{TemplateFormPage.studyMap[sfc.distributionDate].templateField.fieldInputLevelString}">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.distributionDate].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="distributionDate" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.distributionDateHelp}" linkText="#{editstudybundle.distributionDateLabel}" heading="#{editstudybundle.distributionDateHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.distributionDate].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.distributionDate].recommended}"/>
                </div>
                <div jsfc="ice:panelGroup" id="groupPanel26" styleClass="#{TemplateFormPage.studyMap[sfc.distributionDate].templateField.fieldInputLevelString}">
                  <ice:inputText id="input_distributionDate" styleClass="formDateFormat" value="#{TemplateFormPage.template.metadata.distributionDate}"  
                                 >
                  </ice:inputText>
                  <ice:outputText value=" (YYYY or YYYY-MM or YYYY-MM-DD)"/>
                  <ice:message styleClass="errorMessage" for="input_distributionDate"/>
                </div>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.depositor].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.depositor].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="depositor" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.depositorHelp}" linkText="#{editstudybundle.depositorLabel}" heading="#{editstudybundle.depositorHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.depositor].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.depositor].recommended}"/>
                </ice:column>
                <ice:column styleClass="#{TemplateFormPage.studyMap[sfc.depositor].templateField.fieldInputLevelString}">
                  <ice:inputText id="input_depositor" size="45" value="#{TemplateFormPage.template.metadata.depositor}" />
                  <ice:message styleClass="errorMessage" for="input_depositor"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.dateOfDeposit].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column  styleClass="vdcEditStudyField #{TemplateFormPage.studyMap[sfc.dateOfDeposit].templateField.fieldInputLevelString}">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.dateOfDeposit].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="dateOfDeposit" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.depositDateHelp}" linkText="#{editstudybundle.depositDateLabel}" heading="#{editstudybundle.depositDateHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.dateOfDeposit].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.dateOfDeposit].recommended}"/>
                </ice:column>
                <ice:column styleClass="vdcEditStudyField #{TemplateFormPage.studyMap[sfc.dateOfDeposit].templateField.fieldInputLevelString}">
                  <ice:outputText value="&lt;#{editstudybundle.depositDateLabel} cannot be set in a template&gt;"/>
                  <ice:message styleClass="errorMessage" for="input_dateOfDeposit"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.seriesInputLevel}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField #{TemplateFormPage.seriesInputLevel}">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.seriesName].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="seriesName" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.seriesHelp}" linkText="#{editstudybundle.seriesLabel}" heading="#{editstudybundle.seriesHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.seriesInputLevel=='required'}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.seriesInputLevel=='recommended'}"/>
                </ice:column>
                <ice:column>
                  <div jsfc="ice:panelGroup" id="groupPanel29" styleClass="vdcEditStudyField #{TemplateFormPage.studyMap[sfc.seriesName].templateField.fieldInputLevelString}">
                    <dvn:inlinehelp helpMessage="#{editstudybundle.seriesHelp}" linkText="#{editstudybundle.seriesLabel}" heading="#{editstudybundle.seriesHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText binding="#{TemplateFormPage.inputSeries}" id="input_seriesName"
                                   value="#{TemplateFormPage.template.metadata.seriesName}"
                                   styleClass="formHtmlEnabled">
                      <f:validator validatorId="XhtmlValidator"/>
                    </ice:inputText>
                    <ice:message styleClass="errorMessage" for="input_seriesName"/>
                  </div>
                  <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.seriesName].templateField.fieldInputLevelString}" >
                    <dvn:inlinehelp helpMessage="#{editstudybundle.seriesInformationHelp}" linkText="#{editstudybundle.seriesInformationLabel}" heading="#{editstudybundle.seriesInformationHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText binding ="#{TemplateFormPage.inputSeriesInformation}" id="input_seriesInformation"
                                   size="45"
                                   value="#{TemplateFormPage.template.metadata.seriesInformation}"
                                   validator="#{TemplateFormPage.validateSeries}"
                                   styleClass="formHtmlEnabled">
                      <f:validator validatorId="XhtmlValidator"/>
                    </ice:inputText>
                    <ice:message styleClass="errorMessage" for="input_seriesInformation"/>
                  </div>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.versionInputLevel}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="#{TemplateFormPage.versionInputLevel}">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.studyVersion].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="studyVersion" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.seriesVersionHelp}" linkText="#{editstudybundle.seriesVersionLabel}" heading="#{editstudybundle.seriesVersionHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.versionInputLevel=='required'}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.versionInputLevel=='recommended'}"/>
                </ice:column>
                <ice:column>
                  <div jsfc="ice:panelGroup" styleClass="#{TemplateFormPage.studyMap[sfc.studyVersion].templateField.fieldInputLevelString}">
                    <dvn:inlinehelp helpMessage="#{editstudybundle.seriesVersionHelp}" linkText="#{editstudybundle.seriesVersionLabel}" heading="#{editstudybundle.seriesVersionHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText  binding="#{TemplateFormPage.inputVersion}" id="input_studyVersion" value="#{TemplateFormPage.template.metadata.studyVersion}"  
                                    />
                    <ice:message styleClass="errorMessage" for="input_studyVersion"/>
                  </div>
                  <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.versionDate].templateField.fieldInputLevelString}">
                    <dvn:inlinehelp helpMessage="#{editstudybundle.seriesVersionDateHelp}" linkText="#{editstudybundle.seriesVersionDateLabel}" heading="#{editstudybundle.seriesVersionDateHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText binding="#{TemplateFormPage.inputVersionDate}" validator="#{TemplateFormPage.validateVersion}" id="input_versionDate" styleClass="formDateFormat" value="#{TemplateFormPage.template.metadata.versionDate}" 
                                   >

                    </ice:inputText>
                    <ice:outputText value=" (YYYY or YYYY-MM or YYYY-MM-DD)"/>
                    <ice:message styleClass="errorMessage" for="input_versionDate"/>
                  </div>
                </ice:column>
              </ice:panelGrid>
              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.replicationFor].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.replicationFor].templateField.fieldInputLevelString}">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.replicationFor].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="replicationFor" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.replicationForHelp}" linkText="#{editstudybundle.replicationForLabel}" heading="#{editstudybundle.replicationForHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.replicationFor].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.replicationFor].recommended}"/>
                </ice:column>
                <ice:column styleClass="#{TemplateFormPage.studyMap[sfc.replicationFor].templateField.fieldInputLevelString}">
                  <ice:inputTextarea cols="90" rows="4"
                                     id="input_replicationFor"
                                     value="#{TemplateFormPage.template.metadata.replicationFor}"
                                     styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_replicationFor"/>
                </ice:column>
              </ice:panelGrid>

              <div jsfc="ice:panelGroup" id="groupPanel12" styleClass="vdcStudyInfoHeader #{TemplateFormPage.abstractAndScopeInputLevel}">
                <ice:outputText id="outputText65" value="Abstract and Scope"/>
              </div>

              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable" rowClasses="#{TemplateFormPage.abstractInputLevel}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableAbstracts}"
                                 value="#{TemplateFormPage.template.metadata.studyAbstracts}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.abstractText].templateField.fieldInputLevelString}"
                                        rendered ="#{TemplateFormPage.dataTableAbstracts.rowIndex==0}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="abstractText" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{editstudybundle.abstractHelp}" linkText="#{editstudybundle.abstractLabel}" heading="#{editstudybundle.abstractHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.abstractInputLevel=='required'}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.abstractInputLevel=='recommended'}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div>
                        <div styleClass="#{TemplateFormPage.studyMap[sfc.abstractText].templateField.fieldInputLevelString}">
                          <ice:outputText value="Note: Copying and pasting from a Word document can create errors when you save this page."/>
                          <br/>
                          <dvn:inlinehelp helpMessage="#{editstudybundle.abstractHelp}" linkText="#{editstudybundle.abstractLabel}" heading="#{editstudybundle.abstractHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputTextarea cols="90" rows="12"
                                             id="input_abstractText"
                                             binding="#{TemplateFormPage.inputAbstractText}"
                                             value="#{currentRow.text}"
                                             styleClass="formHtmlEnabled">
                            <f:validator validatorId="XhtmlValidator"/>
                          </ice:inputTextarea>
                          <ice:message styleClass="errorMessage" for="input_abstractText"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.abstractDate].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.abstractDateHelp}" linkText="#{editstudybundle.abstractDateLabel}" heading="#{editstudybundle.abstractDateHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText binding="#{TemplateFormPage.inputAbstractDate}" validator="#{TemplateFormPage.validateStudyAbstract}" id="input_abstractDate" styleClass="formDateFormat" value="#{currentRow.date}" 
                                         >

                          </ice:inputText>
                          <ice:outputText value=" (YYYY or YYYY-MM or YYYY-MM-DD)"/>
                          <ice:message styleClass="errorMessage" for="input_abstractDate"/>
                        </div>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true"  rendered="#{TemplateFormPage.dataTableAbstracts.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable" rowClasses="#{TemplateFormPage.keywordInputLevel}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableKeywords}"
                                 value="#{TemplateFormPage.template.metadata.studyKeywords}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.keywordValue].templateField.fieldInputLevelString}"
                                        rendered ="#{TemplateFormPage.dataTableKeywords.rowIndex==0}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="keywordValue" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{editstudybundle.keywordHelp}" linkText="#{editstudybundle.keywordLabel}" heading="#{editstudybundle.keywordHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.keywordValue].required}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.keywordValue].recommended}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div class="vdcEditStudyFieldFloatWrap">
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 #{TemplateFormPage.studyMap[sfc.keywordValue].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.keywordHelp}" linkText="#{editstudybundle.keywordLabel}" heading="#{editstudybundle.keywordHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText binding="#{TemplateFormPage.inputKeywordValue}" id="input_keywordValue" value="#{currentRow.value}" 
                                         />
                          <ice:message styleClass="errorMessage" for="input_keywordValue"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.keywordVocab].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.keywordVocabularyHelp}" linkText="#{editstudybundle.keywordVocabularyLabel}" heading="#{editstudybundle.keywordVocabularyHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText validator="#{TemplateFormPage.validateStudyKeyword}" binding="#{TemplateFormPage.inputKeywordVocab}" id="input_keywordVocab" value="#{currentRow.vocab}" 
                                         />
                          <ice:message styleClass="errorMessage" for="input_keywordVocab"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.keywordVocabURI].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.keywordVocabularyURLHelp}" linkText="#{editstudybundle.keywordVocabularyURLLabel}" heading="#{editstudybundle.keywordVocabularyURLHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText id="input_keywordVocabURI"
                                         validator="#{TemplateFormPage.validateStudyKeyword}"
                                         binding="#{TemplateFormPage.inputKeywordVocabUri}"
                                         size="45"
                                         maxlength="255"
                                         value="#{currentRow.vocabURI}"
                                         >
                            <f:validator validatorId="UrlValidator"/>
                          </ice:inputText>
                          <ice:outputText value="(http://example-domain.edu/)"/>
                          <ice:message styleClass="errorMessage" for="input_keywordVocabURI"/>
                        </div>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableKeywords.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable" rowClasses="#{TemplateFormPage.topicInputLevel}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 id="dataTableTopicClass"
                                 binding="#{TemplateFormPage.dataTableTopicClass}"
                                 value="#{TemplateFormPage.template.metadata.studyTopicClasses}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.topicClassValue].templateField.fieldInputLevelString}"
                                        rendered ="#{TemplateFormPage.dataTableTopicClass.rowIndex==0}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="topicClassValue" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{editstudybundle.topicClassificationHelp}" linkText="#{editstudybundle.topicClassificationLabel}" heading="#{editstudybundle.topicClassificationHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.topicClassValue].required}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.topicClassValue].recommended}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div class="vdcEditStudyFieldFloatWrap">
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.topicClassValue].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.topicClassificationHelp}" linkText="#{editstudybundle.topicClassificationLabel}" heading="#{editstudybundle.topicClassificationHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText binding="#{TemplateFormPage.inputTopicClassValue}" id="input_topicClassValue" value="#{currentRow.value}" />
                          <ice:message styleClass="errorMessage" for="input_topicClassValue"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.topicClassVocab].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.topicClassVocabularyHelp}" linkText="#{editstudybundle.topicClassVocabularyLabel}" heading="#{editstudybundle.topicClassVocabularyHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" validator="#{TemplateFormPage.validateStudyTopicClass}" binding="#{TemplateFormPage.inputTopicClassVocab}" id="input_topicClassVocab" value="#{currentRow.vocab}" />
                          <ice:message styleClass="errorMessage" for="input_topicClassVocab"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.topicClassVocabURI].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.topicClassVocabularyURLHelp}" linkText="#{editstudybundle.topicClassVocabularyURLLabel}" heading="#{editstudybundle.topicClassVocabularyURLHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText id="input_topicClassVocabURI"
                                         binding="#{TemplateFormPage.inputTopicClassVocabUri}"
                                         validator="#{TemplateFormPage.validateStudyTopicClass}"
                                         size="45"
                                         maxlength="255"
                                         value="#{currentRow.vocabURI}"
                                         >
                            <f:validator validatorId="UrlValidator"/>
                          </ice:inputText>
                          <ice:outputText value="(http://example-domain.edu/)"/>
                          <ice:message styleClass="errorMessage" for="input_topicClassVocabURI"/>
                        </div>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableTopicClass.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable"
                             rowClasses="#{TemplateFormPage.studyMap[sfc.relatedPublications].templateField.fieldInputLevelString}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableRelPublications}"
                                 value="#{TemplateFormPage.template.metadata.studyRelPublications}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.relatedPublications].templateField.fieldInputLevelString}"
                                        rendered ="#{TemplateFormPage.dataTableRelPublications.rowIndex==0}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="relatedPublications" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{editstudybundle.relatedPublicationsHelp}" linkText="#{editstudybundle.relatedPublicationsLabel}" heading="#{editstudybundle.relatedPublicationsHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.relatedPublications].required}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.relatedPublications].recommended}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div>
                        <ice:inputTextarea cols="90" rows="4"
                                           id="input_relatedPublications"
                                           binding="#{TemplateFormPage.inputRelPublicationName}"
                                           value="#{currentRow.text}"
                                           styleClass="formHtmlEnabled">
                          <f:validator validatorId="XhtmlValidator"/>
                        </ice:inputTextarea>
                        <ice:message styleClass="errorMessage" for="input_relatedPublications"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableRelPublications.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable"
                             rowClasses="#{TemplateFormPage.studyMap[sfc.relatedMaterial].templateField.fieldInputLevelString}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableRelMaterials}"
                                 value="#{TemplateFormPage.template.metadata.studyRelMaterials}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.relatedMaterial].templateField.fieldInputLevelString}"
                                        rendered ="#{TemplateFormPage.dataTableRelMaterials.rowIndex==0}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="relatedMaterial" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{editstudybundle.relatedMaterialHelp}" linkText="#{editstudybundle.relatedMaterialLabel}" heading="#{editstudybundle.relatedMaterialHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.relatedMaterial].required}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.relatedMaterial].recommended}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div>
                        <ice:inputTextarea cols="90" rows="4"
                                           id="input_relatedMaterial"
                                           binding="#{TemplateFormPage.inputRelMaterial}"
                                           value="#{currentRow.text}"
                                           styleClass="formHtmlEnabled">
                          <f:validator validatorId="XhtmlValidator"/>
                        </ice:inputTextarea>
                        <ice:message styleClass="errorMessage" for="input_relatedMaterial"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableRelMaterials.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable"
                             rowClasses="#{TemplateFormPage.studyMap[sfc.relatedStudies].templateField.fieldInputLevelString}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableRelStudies}"
                                 value="#{TemplateFormPage.template.metadata.studyRelStudies}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.relatedStudies].templateField.fieldInputLevelString}"
                                        rendered ="#{TemplateFormPage.dataTableRelStudies.rowIndex==0}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="relatedStudies" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{editstudybundle.relatedStudiesHelp}" linkText="#{editstudybundle.relatedStudiesLabel}" heading="#{editstudybundle.relatedStudiesHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.relatedStudies].required}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.relatedStudies].recommended}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div>
                        <ice:inputTextarea cols="90" rows="4"
                                           id="input_relatedStudies"
                                           binding="#{TemplateFormPage.inputRelStudy}"
                                           value="#{currentRow.text}"
                                           styleClass="formHtmlEnabled">
                          <f:validator validatorId="XhtmlValidator"/>
                        </ice:inputTextarea>
                        <ice:message styleClass="errorMessage" for="input_relatedStudies"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableRelStudies.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable"
                             rowClasses="#{TemplateFormPage.studyMap[sfc.otherReferences].templateField.fieldInputLevelString}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableOtherReferences}"
                                 value="#{TemplateFormPage.template.metadata.studyOtherRefs}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.otherReferences].templateField.fieldInputLevelString}"
                                        rendered ="#{TemplateFormPage.dataTableOtherReferences.rowIndex==0}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="otherReferences" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{editstudybundle.otherReferencesHelp}" linkText="#{editstudybundle.otherReferencesLabel}" heading="#{editstudybundle.otherReferencesHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.otherReferences].required}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.otherReferences].recommended}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div>
                        <ice:inputText id="input_otherReferences"
                                       binding="#{TemplateFormPage.inputOtherReference}"
                                       value="#{currentRow.text}"
                                       size="90"
                                       styleClass="formHtmlEnabled">
                          <f:validator validatorId="XhtmlValidator"/>
                        </ice:inputText>
                        <ice:message styleClass="errorMessage" for="input_otherReferences"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableOtherReferences.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.timePeriodCoveredStart].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.timePeriodCoveredStart].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="timePeriodCoveredStart" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.timePeriodStartHelp}" linkText="#{editstudybundle.timePeriodStartLabel}" heading="#{editstudybundle.timePeriodStartHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.timePeriodCoveredStart].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.timePeriodCoveredStart].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_timePeriodCoveredStart" styleClass="formDateFormat" value="#{TemplateFormPage.template.metadata.timePeriodCoveredStart}" >
                    <f:validator validatorId="DateValidator"/>
                  </ice:inputText>
                  <ice:outputText value=" (YYYY or YYYY-MM or YYYY-MM-DD)"/>
                  <ice:message styleClass="errorMessage" for="input_timePeriodCoveredStart"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.timePeriodCoveredEnd].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.timePeriodCoveredEnd].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="timePeriodCoveredEnd" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.timePeriodEndHelp}" linkText="#{editstudybundle.timePeriodEndLabel}" heading="#{editstudybundle.timePeriodEndHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.timePeriodCoveredEnd].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.timePeriodCoveredEnd].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_timePeriodCoveredEnd" styleClass="formDateFormat" value="#{TemplateFormPage.template.metadata.timePeriodCoveredEnd}" >
                    <f:validator validatorId="DateValidator"/>
                  </ice:inputText>
                  <ice:outputText value=" (YYYY or YYYY-MM or YYYY-MM-DD)"/>
                  <ice:message styleClass="errorMessage" for="input_timePeriodCoveredEnd"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.dateOfCollectionStart].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.dateOfCollectionStart].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="dateOfCollectionStart" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.collectionDateStartHelp}" linkText="#{editstudybundle.collectionDateStartLabel}" heading="#{editstudybundle.collectionDateStartHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.dateOfCollectionStart].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.dateOfCollectionStart].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_dateOfCollectionStart" styleClass="formDateFormat" value="#{TemplateFormPage.template.metadata.dateOfCollectionStart}">
                    <f:validator validatorId="DateValidator"/>
                  </ice:inputText>
                  <ice:outputText value=" (YYYY or YYYY-MM or YYYY-MM-DD)"/>
                  <ice:message styleClass="errorMessage" for="input_dateOfCollectionStart"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.dateOfCollectionEnd].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.dateOfCollectionEnd].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="dateOfCollectionEnd" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.collectionDateEndHelp}" linkText="#{editstudybundle.collectionDateEndLabel}" heading="#{editstudybundle.collectionDateEndHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.dateOfCollectionEnd].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.dateOfCollectionEnd].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_dateOfCollectionEnd" styleClass="formDateFormat" value="#{TemplateFormPage.template.metadata.dateOfCollectionEnd}"  >
                    <f:validator validatorId="DateValidator"/>
                  </ice:inputText>
                  <ice:outputText value=" (YYYY or YYYY-MM or YYYY-MM-DD)"/>
                  <ice:message styleClass="errorMessage" for="input_dateOfCollectionEnd"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.country].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.country].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="country" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.countryHelp}" linkText="#{editstudybundle.countryLabel}" heading="#{editstudybundle.countryHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.country].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.country].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_country" size="45" value="#{TemplateFormPage.template.metadata.country}" />
                  <ice:message styleClass="errorMessage" for="input_country"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.geographicCoverage].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.geographicCoverage].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="geographicCoverage" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.geographicCoverageHelp}" linkText="#{editstudybundle.geographicCoverageLabel}" heading="#{editstudybundle.geographicCoverageHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.geographicCoverage].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.geographicCoverage].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_geographicCoverage" size="45" value="#{TemplateFormPage.template.metadata.geographicCoverage}" />
                  <ice:message styleClass="errorMessage" for="input_geographicCoverage"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.geographicUnit].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.geographicUnit].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="geographicUnit" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.geographicUnitHelp}" linkText="#{editstudybundle.geographicUnitLabel}" heading="#{editstudybundle.geographicUnitHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.geographicUnit].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.geographicUnit].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_geographicUnit" size="45" value="#{TemplateFormPage.template.metadata.geographicUnit}" />
                  <ice:message styleClass="errorMessage" for="input_geographicUnit"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.westLongitude].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.westLongitude].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="westLongitude" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.geographicBoundingBoxHelp}" linkText="#{editstudybundle.geographicBoundingBoxLabel}" heading="#{editstudybundle.geographicBoundingBoxHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.westLongitude].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.westLongitude].recommended}"/>
                </ice:column>
                <ice:column styleClass="vdcEditStudyFieldFloatWrap">
                  <div class="vdcEditStudyFieldFloat1 vdcEditStudyGroupField">
                    <dvn:inlinehelp helpMessage="#{editstudybundle.westLongitudeHelp}" linkText="#{editstudybundle.westLongitudeLabel}"
                                    heading="#{editstudybundle.westLongitudeHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText id="input_westLongitude" binding="#{TemplateFormPage.inputWestLongitude}" 
                                   value="#{TemplateFormPage.template.metadata.studyGeoBoundings[0].westLongitude}"
                                   />
                  </div>
                  <ice:message styleClass="errorMessage" for="input_westLongitude"/>

                  <div class="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                    <dvn:inlinehelp helpMessage="#{editstudybundle.eastLongitudeHelp}" 
                                    linkText="#{editstudybundle.eastLongitudeLabel}"
                                    heading="#{editstudybundle.eastLongitudeHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText binding="#{TemplateFormPage.inputEastLongitude}"
                                   id="input_eastLongitude"
                                   value="#{TemplateFormPage.template.metadata.studyGeoBoundings[0].eastLongitude}"
                                   />
                  </div>
                  <ice:message styleClass="errorMessage" for="input_eastLongitude"/>

                  <div class="vdcEditStudyFieldFloat1 vdcEditStudyFieldFloat3 vdcEditStudyGroupField">
                    <dvn:inlinehelp helpMessage="#{editstudybundle.northLatitudeHelp}" linkText="#{editstudybundle.northLatitudeLabel}" heading="#{editstudybundle.northLatitudeHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText binding="#{TemplateFormPage.inputNorthLatitude}" id="input_northLatitude" value="#{TemplateFormPage.template.metadata.studyGeoBoundings[0].northLatitude}" />
                  </div>
                  <ice:message styleClass="errorMessage" for="input_northLatitude"/>

                  <div class="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                    <dvn:inlinehelp helpMessage="#{editstudybundle.southLatitudeHelp}" linkText="#{editstudybundle.southLatitudeLabel}" heading="#{editstudybundle.southLatitudeHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                    <br/>
                    <ice:inputText binding="#{TemplateFormPage.inputSouthLatitude}" id="input_southLatitude" value="#{TemplateFormPage.template.metadata.studyGeoBoundings[0].southLatitude}"  />
                  </div>
                  <ice:message styleClass="errorMessage" for="input_southLatitude"/>
                  <ice:inputHidden validator="#{TemplateFormPage.validateGeographicBounding}" value="test" required="true"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.unitOfAnalysis].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.unitOfAnalysis].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="unitOfAnalysis" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.unitOfAnalysisHelp}" linkText="#{editstudybundle.unitOfAnalysisLabel}" heading="#{editstudybundle.unitOfAnalysisHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.unitOfAnalysis].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.unitOfAnalysis].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputTextarea id="input_unitOfAnalysis" cols="90" rows="2" value="#{TemplateFormPage.template.metadata.unitOfAnalysis}" styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_unitOfAnalysis"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.universe].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.universe].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="universe" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>                  
                  <dvn:inlinehelp helpMessage="#{editstudybundle.universeHelp}" linkText="#{editstudybundle.universeLabel}" heading="#{editstudybundle.universeHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.universe].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.universe].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputTextarea id="input_universe" cols="90" rows="2" value="#{TemplateFormPage.template.metadata.universe}"  styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_universe"/>
                </ice:column>
              </ice:panelGrid>

               <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.kindOfData].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true" 
                                        value="#{TemplateFormPage.studyMap[sfc.kindOfData].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="universe" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>                  
                  <dvn:inlinehelp helpMessage="#{editstudybundle.universeHelp}" linkText="#{editstudybundle.kindOfDataLabel}" heading="#{editstudybundle.kindOfDataHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.kindOfData].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.kindOfData].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputTextarea id="input_kindOfData" cols="90" rows="2" value="#{TemplateFormPage.template.metadata.kindOfData}"  styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_kindOfData"/>
                </ice:column>
              </ice:panelGrid>
              
              
              <!-- data collection methodology section -->
              <!-- DCM header-->
              <div jsfc="ice:panelGroup" styleClass="vdcStudyInfoHeader #{TemplateFormPage.dataCollectionMethodologyInputLevel}">
                <ice:outputText value="Data Collection / Methodology"/>
              </div>
              <!-- end of DCM header-->

              <!-- Add Field section -->
              <div style="border-bottom:1px solid #DADEE0; padding-bottom:1em;">
                
                <ice:graphicImage value="/resources/images/icon_info.gif" styleClass="dvn_icon"/>
                <ice:outputText value=" Add custom Data Collection/Methodology fields by using the form and clicking the Add Field button." escape="false"/>
                    <div jsfc="ice:panelGroup" styleClass="dvnMsgBlockRound dvnWarningMessage" rendered="#{!empty flash.message }">
                      <div class="dvnMsgBlockContainer">
                        <p><ice:outputText id="addFieldMessage" value="#{flash.message}"/></p>
                      </div>
                    </div>
                <ice:panelGrid cellpadding="0" cellspacing="0" columns="3" width="100%">
                    <ice:column>
                        <ice:selectOneMenu immediate="false" rendered="#{TemplateFormPage.networkEdit}" binding="#{TemplateFormPage.selectNewDcmFieldInputLevel}">
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <ice:outputText value="Allow multiple values" rendered="#{TemplateFormPage.networkEdit}"/>
                        <ice:selectBooleanCheckbox partialSubmit="false" binding="#{TemplateFormPage.allowMultiplesCheck}" rendered="#{TemplateFormPage.networkEdit}"/>
                    </ice:column>
                    <ice:column>
                        <div>
                            <ice:outputText value="Field Name" rendered="#{TemplateFormPage.networkEdit}"/>
                            <ice:inputText id="input_adHocFieldName" size="90" binding="#{TemplateFormPage.inputStudyFieldName}" rendered="#{TemplateFormPage.networkEdit}"></ice:inputText>
                            <br/>
                            <ice:outputText value="Field Description" rendered="#{TemplateFormPage.networkEdit}"/>
                            <ice:inputText id="input_adHocFieldDescription" size="90" binding="#{TemplateFormPage.inputStudyFieldDescription}" rendered="#{TemplateFormPage.networkEdit}"></ice:inputText>
                        </div>
                        <div>
                            <ice:outputText value="Field Type" rendered="#{TemplateFormPage.networkEdit}"/>
                            <ice:selectOneMenu immediate="false" partialSubmit="false" binding="#{TemplateFormPage.selectFieldType}" rendered="#{TemplateFormPage.networkEdit}">
                                <f:selectItems value="#{TemplateFormPage.fieldTypeSelectItems}"/>
                            </ice:selectOneMenu>
                        </div>
                    </ice:column>
                    <ice:column>
                        <ice:commandButton partialSubmit="true" value="Add Field" action="#{TemplateFormPage.saveField}" rendered="#{TemplateFormPage.networkEdit}"/>
                    </ice:column>
                </ice:panelGrid>
              </div>
              <!-- Generic control-->
              <!-- end of Generic control-->
              
              <style type="text/css">
                  .iceDatTbl.tableDCM {border-width:0 0 0 0; margin-top:0;}
                  .tableDCM tr.iceDatTblRow1, .tableDCM tr.iceDatTblRow2 {border-width:0 0 0 0;}
                  .tableDCM td {border-width:0 0 1px 0;}
              </style>

                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%" styleClass="tableDCM"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dcmFieldTable}"
                                 value="#{TemplateFormPage.adHocFields}" var="dcmItem">
                    <ice:column>
                      <div class="vdcEditStudyField">
                        <ice:selectOneMenu immediate="true" partialSubmit="true"
                                           value="#{dcmItem.fieldInputLevelString}"
                                           valueChangeListener="#{TemplateFormPage.changeFieldInputValueDCM}">
                            <f:attribute name="dcmSortOrder" value="#{dcmItem.dcmSortOrder}" />
                            <f:attribute name="tf_id" value="#{dcmItem.id}" />
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu>
                        <dvn:inlinehelp helpMessage="#{dcmItem.studyField.description}" heading="#{dcmItem.studyField.name}" linkText="#{dcmItem.studyField.name}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{dcmItem.required}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{dcmItem.recommended}"/>
                        <ice:outputText  value="Allow multiple values"/>
                        <ice:selectBooleanCheckbox immediate="true" partialSubmit="true" value="#{dcmItem.allowMultiples}"/>
                      <ice:commandButton  value="Remove Field" 
                                          actionListener="#{TemplateFormPage.removeAdHocField}" rendered="#{(dcmItem.studyField.id > 98 or dcmItem.studyField.id == null) and TemplateFormPage.networkEdit}" >
                                         <f:attribute name="studyFieldId" value="#{dcmItem.studyField.id}" />
                                          <f:attribute name="studyFieldName" value="#{dcmItem.studyField.name}" />
                      </ice:commandButton>
                      </div>
                    </ice:column>
                    <ice:column>
                        
                      <ui:repeat var="fieldValRow" value="#{dcmItem.templateFieldValues}" >
                      <ice:inputText id="input_adHocField" size="90" visible="#{empty(dcmItem.templateFieldControlledVocabulary)}"
                                     value="#{fieldValRow.strValue}"
                                     styleClass="formHtmlEnabled">
                      </ice:inputText>
                      </ui:repeat>
                      <ice:outputText id="controlledVocabHeader"  visible="#{!empty(dcmItem.templateFieldControlledVocabulary)}"
                                     value="Controlled Vocabulary"
                                     >
                      </ice:outputText>
                        
                      <ui:repeat var="fieldControlledVocabRow" value="#{dcmItem.templateFieldControlledVocabulary}" >
                      <ice:outputText id="controlledVocabRow"  visible="#{!empty(dcmItem.templateFieldControlledVocabulary)}"
                                     value="#{fieldControlledVocabRow.strValue}"
                                     >
                      </ice:outputText>
                      </ui:repeat>

                    </ice:column>
                    <ice:column>
                        <ice:commandButton immediate="true" value="Move Up" alt="Move Up" title="Move Up" image="/resources/images/icon_moveup.png" actionListener="#{TemplateFormPage.moveUp}">
                                         <f:attribute name="sf_id" value="#{dcmItem.studyField.id}" />
                                         <f:attribute name="dcmSortOrder" value="#{dcmItem.dcmSortOrder}" />
                      </ice:commandButton>
                      <ice:commandButton immediate="true" value="Move Down" alt="Move Down" title="Move Down" image="/resources/images/icon_movedown.png" actionListener="#{TemplateFormPage.moveDown}">
                          <f:attribute name="sf_id" value="#{dcmItem.studyField.id}" />
                          <f:attribute name="dcmSortOrder" value="#{dcmItem.dcmSortOrder}" />                          
                      </ice:commandButton>
                        
                    </ice:column>
                    <ice:column>
                      <ice:commandButton  immediate="true" image="/resources/images/icon_add.gif" rendered="#{dcmItem.allowMultiples}"
                                         actionListener="#{TemplateFormPage.addDcmRow}">
                                         <f:attribute name="sf_id" value="#{dcmItem.studyField.id}" />
                                         <f:attribute name="dcmSortOrder" value="#{dcmItem.dcmSortOrder}" />
                      </ice:commandButton>
                      <ice:commandButton immediate="true"
                                         rendered="#{dcmItem.allowMultiples}"
                                         image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeDcmRow}">
                          <f:attribute name="sf_id" value="#{dcmItem.studyField.id}" />
                          <f:attribute name="dcmSortOrder" value="#{dcmItem.dcmSortOrder}" />
                      </ice:commandButton>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton   value="Update Controlled Vocabulary" actionListener="#{TemplateFormPage.openPopup}">
                          <f:attribute name="sf_id" value="#{dcmItem.studyField.id}" />
                          <f:attribute name="dcmSortOrder" value="#{dcmItem.dcmSortOrder}" />
                      </ice:commandButton>
                    </ice:column>
                  </ice:dataTable>
              <!-- end of data collection methodology section -->              
              
              <!-- DATA SET AVAILABILITY SECTION -->
              <div jsfc="ice:panelGroup" styleClass="vdcStudyInfoHeader #{TemplateFormPage.dataSetAvailabilityInputLevel}">
                <ice:outputText value="Data Set Availability"/>
              </div>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.placeOfAccess].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2" id="gridPanel5a">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.placeOfAccess].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="placeOfAccess" />
                           <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.dataAccessPlaceHelp}" linkText="#{editstudybundle.dataAccessPlaceLabel}" heading="#{editstudybundle.dataAccessPlaceHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.placeOfAccess].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.placeOfAccess].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_placeOfAccess"
                                 size="90"
                                 value="#{TemplateFormPage.template.metadata.placeOfAccess}"
                                 styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputText>
                  <ice:message styleClass="errorMessage" for="input_placeOfAccess"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.originalArchive].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.originalArchive].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="originalArchive" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.originalArchiveHelp}" linkText="#{editstudybundle.originalArchiveLabel}" heading="#{editstudybundle.originalArchiveHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.originalArchive].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.originalArchive].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_originalArchive"
                                 size="90"
                                 value="#{TemplateFormPage.template.metadata.originalArchive}"
                                 styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputText>
                  <ice:message styleClass="errorMessage" for="input_originalArchive"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.availabilityStatus].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.availabilityStatus].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="availabilityStatus" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                   <dvn:inlinehelp helpMessage="#{editstudybundle.availabilityHelp}" linkText="#{editstudybundle.availabilityLabel}" heading="#{editstudybundle.availabilityHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.availabilityStatus].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.availabilityStatus].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_availabilityStatus" size="90"
                                 value="#{TemplateFormPage.template.metadata.availabilityStatus}"
                                 styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputText>
                  <ice:message styleClass="errorMessage" for="input_availabilityStatus"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.collectionSize].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.collectionSize].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="collectionSize" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.collectionSizeHelp}" linkText="#{editstudybundle.collectionSizeLabel}" heading="#{editstudybundle.collectionSizeHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.collectionSize].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.collectionSize].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_collectionSize"
                                 size="90"
                                 value="#{TemplateFormPage.template.metadata.collectionSize}"
                                 styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputText>
                  <ice:message styleClass="errorMessage" for="input_collectionSize"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.studyCompletion].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.studyCompletion].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="studyCompletion" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.studyCompletionHelp}" linkText="#{editstudybundle.studyCompletionLabel}" heading="#{editstudybundle.studyCompletionHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.studyCompletion].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.studyCompletion].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText size="90" id="input_studyCompletion"
                                 value="#{TemplateFormPage.template.metadata.studyCompletion}"
                                 styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputText>
                  <ice:message styleClass="errorMessage" for="input_studyCompletion"/>
                </ice:column>
              </ice:panelGrid>
              
              <!-- TERMS OF USE SECTION -->
              <div jsfc="ice:panelGroup" styleClass="vdcStudyInfoHeader #{TemplateFormPage.termsOfUseInputLevel}">
                <ice:outputText value="Terms of Use"/>
              </div>
              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.confidentialityDeclaration].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2" id="gridPanel5">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.confidentialityDeclaration].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="confidentialityDeclaration" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.confidentialityHelp}" linkText="#{editstudybundle.confidentialityLabel}" heading="#{editstudybundle.confidentialityHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.confidentialityDeclaration].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.confidentialityDeclaration].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputTextarea cols="90" rows="4"
                                     id="input_confidentialityDeclaration"
                                     value="#{TemplateFormPage.template.metadata.confidentialityDeclaration}"                                     
                                     styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_confidentialityDeclaration"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.specialPermissions].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.specialPermissions].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="specialPermissions" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.specialPermissionsHelp}" linkText="#{editstudybundle.specialPermissionsLabel}" heading="#{editstudybundle.specialPermissionsHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.specialPermissions].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.specialPermissions].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputTextarea cols="90" rows="4" id="input_specialPermissions"
                                     value="#{TemplateFormPage.template.metadata.specialPermissions}"                                     
                                     styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_specialPermissions"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.restrictions].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.restrictions].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="restrictions" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.restrictionsHelp}" linkText="#{editstudybundle.restrictionsLabel}" heading="#{editstudybundle.restrictionsHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.restrictions].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.restrictions].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputTextarea cols="90" rows="4"
                                     id="input_restrictions"
                                     value="#{TemplateFormPage.template.metadata.restrictions}"                                   
                                     styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_restrictions"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.contact].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.contact].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="contact" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.contactHelp}" linkText="#{editstudybundle.contactLabel}" heading="#{editstudybundle.contactHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.contact].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.contact].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputText id="input_contact"
                                 size="90"
                                 value="#{TemplateFormPage.template.metadata.contact}"
                                 styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputText>
                  <ice:message styleClass="errorMessage" for="input_contact"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.citationRequirements].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.citationRequirements].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="citationRequirements" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.citationRequirementsHelp}" linkText="#{editstudybundle.citationRequirementsLabel}" heading="#{editstudybundle.citationRequirementsHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.citationRequirements].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.citationRequirements].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputTextarea cols="90" rows="4" id="input_citationRequirements"
                                     value="#{TemplateFormPage.template.metadata.citationRequirements}"
                                     styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_citationRequirements"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.depositorRequirements].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.depositorRequirements].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="depositorRequirements" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.depositorRequirementsHelp}" linkText="#{editstudybundle.depositorRequirementsLabel}" heading="#{editstudybundle.depositorRequirementsHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.depositorRequirements].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.depositorRequirements].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputTextarea cols="90" rows="4"
                                     id="input_depositorRequirements"
                                     value="#{TemplateFormPage.template.metadata.depositorRequirements}"
                                     
                                     styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_depositorRequirements"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.conditions].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2" columns="2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.conditions].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="conditions" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.conditionsHelp}" linkText="#{editstudybundle.conditionsLabel}" heading="#{editstudybundle.conditionsHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.conditions].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.conditions].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputTextarea cols="90" rows="4"
                                     id="input_conditions"
                                     value="#{TemplateFormPage.template.metadata.conditions}"
                                     
                                     styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_conditions"/>
                </ice:column>
              </ice:panelGrid>

              <ice:panelGrid cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable #{TemplateFormPage.studyMap[sfc.disclaimer].templateField.fieldInputLevelString}"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2" columns="2">
                <ice:column styleClass="vdcEditStudyField">
                  <ice:selectOneMenu immediate="false" partialSubmit="true"
                                        value="#{TemplateFormPage.studyMap[sfc.disclaimer].templateField.fieldInputLevelString}"
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="disclaimer" />
                  <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                  </ice:selectOneMenu>
                  <dvn:inlinehelp helpMessage="#{editstudybundle.disclaimerHelp}" linkText="#{editstudybundle.disclaimerLabel}" heading="#{editstudybundle.disclaimerHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                  <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.studyMap[sfc.disclaimer].required}"/>
                  <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.studyMap[sfc.disclaimer].recommended}"/>
                </ice:column>
                <ice:column>
                  <ice:inputTextarea cols="90" rows="4"
                                     id="input_disclaimer"
                                     value="#{TemplateFormPage.template.metadata.disclaimer}"
                                     
                                     styleClass="formHtmlEnabled">
                    <f:validator validatorId="XhtmlValidator"/>
                  </ice:inputTextarea>
                  <ice:message styleClass="errorMessage" for="input_disclaimer"/>
                </ice:column>
              </ice:panelGrid>

              <!-- OTHER INFORMATION SECTION -->
              <div jsfc="ice:panelGroup" id="groupPanel15" styleClass="vdcStudyInfoHeader #{TemplateFormPage.noteInputLevel}" >
                <ice:outputText id="outputText160" value="Other Information"/>
              </div>
              <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
              <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                             styleClass="vdcEditStudyTable"
                             rowClasses="#{TemplateFormPage.noteInputLevel}" value="dummy_datatable">
                <ice:column>
                  <ice:dataTable id="dataTableNotes" cellpadding="0" cellspacing="0" width="100%"
                                 columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                 binding="#{TemplateFormPage.dataTableNotes}"
                                 value="#{TemplateFormPage.template.metadata.studyNotes}" var="currentRow">
                    <ice:column>
                      <div class="vdcEditStudyField">
                       <ice:selectOneMenu immediate="false" partialSubmit="true" rendered ="#{TemplateFormPage.dataTableNotes.rowIndex==0}"
                                        value="#{TemplateFormPage.studyMap[sfc.notesInformationType].templateField.fieldInputLevelString}"                                         
                                        valueChangeListener="#{TemplateFormPage.changeFieldInputValue}">
                            <f:attribute name="fieldName" value="notesInformationType" />
                            <f:selectItems value="#{TemplateFormPage.fieldInputLevelSelectItems}"/>
                        </ice:selectOneMenu> 
                        <dvn:inlinehelp helpMessage="#{editstudybundle.notesTypeHelp}" linkText="#{editstudybundle.notesTypeLabel}" heading="#{editstudybundle.notesTypeHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                        <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{TemplateFormPage.noteInputLevel=='required'}"/>
                        <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{TemplateFormPage.noteInputLevel=='recommended'}"/>
                      </div>
                    </ice:column>
                    <ice:column>
                      <div class="vdcEditStudyFieldFloatWrap">
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 #{TemplateFormPage.studyMap[sfc.notesInformationType].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.notesTypeHelp}" linkText="#{editstudybundle.notesTypeLabel}" heading="#{editstudybundle.notesTypeHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText maxlength="255" binding="#{TemplateFormPage.inputNoteType}" id="input_notesInformationType"
                                         value="#{currentRow.type}"
                                         
                                         styleClass="formHtmlEnabled">
                            <f:validator validatorId="XhtmlValidator"/>
                          </ice:inputText>
                          <ice:message styleClass="errorMessage" for="input_notesInformationType"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.notesInformationSubject].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.notesSubjectHelp}" linkText="#{editstudybundle.notesSubjectLabel}" heading="#{editstudybundle.notesSubjectHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText id="input_notesInformationSubject"
                                         maxlength="255"
                                         binding="#{TemplateFormPage.inputNoteSubject}"
                                         value="#{currentRow.subject}"
                                         validator="#{TemplateFormPage.validateStudyNote}"
                                         
                                         styleClass="formHtmlEnabled">
                            <f:validator validatorId="XhtmlValidator"/>
                          </ice:inputText>
                          <ice:message styleClass="errorMessage" for="input_notesInformationSubject"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField #{TemplateFormPage.studyMap[sfc.notesText].templateField.fieldInputLevelString}">
                          <dvn:inlinehelp helpMessage="#{editstudybundle.notesTextHelp}" linkText="#{editstudybundle.notesTextLabel}" heading="#{editstudybundle.notesTextHelpHeading}" eventType="mouseover" cssClass="vdcInlineHelpLink" rendered="true"/>
                          <br/>
                          <ice:inputText id="input_notesText"
                                         size="90"
                                         binding="#{TemplateFormPage.inputNoteText}"
                                         validator="#{TemplateFormPage.validateStudyNote}"
                                         value="#{currentRow.text}"
                                         
                                         styleClass="formHtmlEnabled">
                            <f:validator validatorId="XhtmlValidator"/>
                          </ice:inputText>
                          <ice:message styleClass="errorMessage" for="input_notesText"/>
                        </div>
                      </div>
                    </ice:column>
                    <ice:column>
                      <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{TemplateFormPage.addRow}"/>
                      <ice:commandButton partialSubmit="true" rendered="#{TemplateFormPage.dataTableNotes.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{TemplateFormPage.removeRow}"/>
                    </ice:column>
                  </ice:dataTable>
                </ice:column>
              </ice:dataTable>
            </div>
            <div class="vdcTextRight dvnFormPadding dvnFormMargin">
              <ice:commandButton id="button1b" value="Save" action="#{TemplateFormPage.save}"/>
              <ice:commandButton immediate="true" id="button2b" value="Cancel" action="#{TemplateFormPage.cancel}"/>
            </div>
          </div>
        </div>
                <ice:panelPopup id="controlledVocabularyPopup"
                        draggable="false"
                        visible="#{TemplateFormPage.showPopup}"
                        autoCentre="true"
                        modal="true"
                        style="#{VDCRequest.displayInFrame ? 'top:50px !important;' : ' '}">
            <f:facet name="header">
                <ice:panelGrid id="autoCentPanelGrid"
                               width="100%" cellpadding="0"
                               cellspacing="0" columns="2"
                               columnClasses="none,popupButton">
                    <ice:outputText value="Edit Controlled Vocabulary"/>
                </ice:panelGrid>
            </f:facet>
            <f:facet name="body">
                <ice:panelGrid id="autoCentContent"
                               width="100%" cellpadding="0"
                               cellspacing="0" columns="1"
                               styleClass="popupModalBody" rowClasses="popupModVerNotText,popupModVerNotLabel,popupModVerNotField,popupModVerNotForm">
                                <ice:selectOneMenu id="controlledVocabSelectOneMenu" value="#{TemplateFormPage.selectedControlledVocabString}"
                                                   binding="#{TemplateFormPage.selectControlledVocabulary}">                                                                    
                                    <f:selectItems value="#{TemplateFormPage.controlledVocabStrings}"></f:selectItems>
                                </ice:selectOneMenu>
                                <ice:inputText  id="newControlledVocab" binding="#{TemplateFormPage.inputControlledVocabulary}"  value="#{TemplateFormPage.newControlledVocab}">
                                </ice:inputText>
                                <ice:commandButton   id="addToControlledVocabButton"
                                           action="#{TemplateFormPage.addToControlledVocabList}"
                                           value="Add"
                                           />                               
                               
                       <ice:commandButton id="autoCentPopupOkSave" visible="true" 
                                           action="#{TemplateFormPage.removeSelectedControlledVocab}"
                                           value="Remove Selected"
                                           />

                    <div jsfc="ice:panelGroup" styleClass="dvnFormPadding dvnFormMargin">




                        <ice:commandButton id="autoCentPopupCancel" immediate="true"
                                           actionListener="#{TemplateFormPage.closePopup}"
                                           value="Exit"/>
                        </div>
                </ice:panelGrid>
            </f:facet>
        </ice:panelPopup>

      </ice:form>
    </ui:define>
  </ui:composition>

</body>
</html>
