<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:t="/WEB-INF/tlds/scroller"
      xmlns:ice="http://www.icesoft.com/icefaces/component">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
<ui:composition template="/template.xhtml">
<ui:param name="pageTitle" value="Set Up Data Exploration - #{VDCRequest.dataversePageTitle}"/>
<ui:define name="body">

<ice:form id="form1">
    <ice:inputHidden id="vdcId" value="#{VDCRequest.currentVDCId}"/>
<script type="text/javascript">
    // <![CDATA[
    var timeout= 400; //milliseconds to wait for no activity
    var countEvents= 0;
    function delayedRequest(form,field,event){
    countEvents++;
    setTimeout(function() {
    countEvents--;
    if(countEvents==0){
        iceSubmitPartial(form,field,event);
    }
    },timeout);
    }
    // ]]>
</script>

    <div style="overflow:hidden;">
        <div style="float:left; margin-right:2em;">
        <ice:selectOneMenu value="#{SetUpDataExplorationPage.studyFileId}" rendered="#{SetUpDataExplorationPage.selectFile}" partialSubmit="true" binding="#{SetUpDataExplorationPage.selectStudyFile}"
                           onchange="getElementById('form1:studyFileIdButton').click();">
            <f:selectItems value="#{SetUpDataExplorationPage.studyFileIdSelectItems}"/>
        </ice:selectOneMenu>
        <ice:outputText rendered="#{!SetUpDataExplorationPage.selectFile}" value="File Name #{SetUpDataExplorationPage.selectStudyFile}"/>
        </div>
        <div style="float:left;">
            <ice:graphicImage value="/resources/images/icon_information.18.png" styleClass="dvn_icon"/>
            <ice:outputText value=" Select A Data File for Data Exploration Set-up"/>
        </div>
    </div>

    <!-- hidden button that is clicked by select menu's onchange action -->
    <ice:commandButton id="studyFileIdButton" visible="false" value="Change" action="#{SetUpDataExplorationPage.resetStudyFileId}"/>
    <br/>
    <div class="dvnFormPadding dvnFormMargin" style="float:right;">
        <ice:commandButton id="validateButton" type="submit" value="Validate" rendered="#{SetUpDataExplorationPage.showCommands}"
                           binding="#{SetUpDataExplorationPage.validateButton}" action="#{SetUpDataExplorationPage.validate}"/>
        <ice:message for="validateButton" id="boxErrorMsg" styleClass="errorMessage"/>

        <ice:commandButton type="submit" value="Release" action="#{SetUpDataExplorationPage.release}" rendered="#{!SetUpDataExplorationPage.dataTable.visualizationEnabled and SetUpDataExplorationPage.showCommands}"/>

        <ice:commandButton type="submit" value="Un-Release" action="#{SetUpDataExplorationPage.unRelease}" rendered="#{SetUpDataExplorationPage.dataTable.visualizationEnabled and SetUpDataExplorationPage.showCommands}"/>

        <ice:commandButton type="submit" value="Cancel" action="#{SetUpDataExplorationPage.cancel}"/>

        <ice:commandButton type="submit" value="Save" action="#{SetUpDataExplorationPage.saveAndExit}" rendered="#{SetUpDataExplorationPage.showCommands}"/>

        <ice:commandButton type="submit" visible="false" value="Save and Continue" action="#{SetUpDataExplorationPage.saveAndContinue}" rendered="#{SetUpDataExplorationPage.showCommands}"/>
    </div>
    <div class="dvn_sectionBoxNoBorders">
        <ice:panelTabSet id="tabSet1" rendered="#{SetUpDataExplorationPage.showCommands}">
            <ice:panelTab id="xVariable" label="X-Variable" url="/dvn#{VDCRequest.currentVDCURL}/faces/subsetting/SetUpDataExploration.xhtml&amp;tab=xVariable">
                <div jsfc="ice:panelGroup" panelLayout="flow">
                    <div jsfc="ice:panelGroup" style="overflow:hidden;">
                        <div jsfc="ice:panelGroup" style="width:60%; float:left; margin-right: 2em;">
                            <ice:dataTable width="100%" cellspacing="0" cellpadding="0" var="group" value="#{SetUpDataExplorationPage.measureGrouping}"
                                               binding="#{SetUpDataExplorationPage.dataTableXAxis}">
                                    <h:column>
                                        <f:facet name="header">
                                            <ice:outputText value="Variable"/>
                                        </f:facet>
                                        <ice:outputText value="#{SetUpDataExplorationPage.xAxisVariable.name}"/>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">
                                            <ice:outputText value="Units"/>
                                        </f:facet>
                                        <ice:outputText value="#{SetUpDataExplorationPage.xAxisUnits}"/>
                                         <ice:inputText id="input_XAxisUnits"
                                                        value="#{SetUpDataExplorationPage.xAxisUnits}"
                                                       size="25"
                                                       maxlength="255"
                                                       binding="#{SetUpDataExplorationPage.inputXAxisUnits}"/>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">
                                            &#160;
                                        </f:facet>
                                        <ice:commandLink id="editXAxis" action="#{SetUpDataExplorationPage.editXAxisAction}" visible="#{!SetUpDataExplorationPage.editXAxis}">
                                             <ice:outputText id="editXAxisText" value="Edit"/>
                                        </ice:commandLink>
                                        <ice:commandLink id="removeXAxis" action="#{SetUpDataExplorationPage.removeXAxisAction}" visible="#{SetUpDataExplorationPage.xAxisSet}">
                                             <ice:outputText id="removeXAxisText" value="Remove"/>
                                        </ice:commandLink>
                                    </h:column>
                            </ice:dataTable>
                        </div>

                        <div jsfc="ice:panelGroup" style="width:35%; float:left;" visible="#{SetUpDataExplorationPage.editXAxis or (!SetUpDataExplorationPage.xAxisSet) }">
                            <ui:include src="SetUpDataExplorationFragment.xhtml"></ui:include>
                        </div>
                    </div>
                </div>
            </ice:panelTab>

            <ice:panelTab id="measures" label="Measures" url="/dvn#{VDCRequest.currentVDCURL}/faces/subsetting/SetUpDataExploration.xhtml&amp;tab=measures">
                <div jsfc="ice:panelGroup" panelLayout="flow">
                    <div jsfc="ice:panelGroup" style="overflow:hidden;">
                        <div jsfc="ice:panelGroup" style="width:60%; float:left; margin-right: 2em;">
                           <div jsfc="ice:panelGroup">

                            <div jsfc="ice:panelGroup" >
                                <ice:commandLink id="addMeasureGroup" action="#{SetUpDataExplorationPage.addMeasureGroup}">
                                      <ice:outputText id="addMeasureGroupText" value="+Add Measure"/>
                                 </ice:commandLink>
                            </div>
                            <div jsfc="ice:panelGroup" >
                                <ice:dataTable width="100%" cellspacing="0" cellpadding="0" var="group" value="#{SetUpDataExplorationPage.measureGroups}"
                                               binding="#{SetUpDataExplorationPage.dataTableVarGroup}">
                                    <h:column>
                                        <f:facet name="header">
                                            <ice:outputLabel value="Name"/>
                                        </f:facet>
                                        <ice:outputText value="#{group.varGroup.name}"/>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">
                                            <ice:outputText value="Type"/>
                                        </f:facet>
                                        <ice:outputText value="Types Selected: #{group.groupTypesSelectedString}"/>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">
                                            <ice:outputText value="Variables"/>
                                        </f:facet>
                                        <ice:outputText value="Variables Selected: #{group.numberOfVariablesSelected}"/>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">
                                            <ice:outputText value="Units"/>
                                        </f:facet>
                                         <ice:outputText value="#{group.varGroup.units}"/>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">
                                            <ice:outputText value="Actions"/>
                                        </f:facet>
                                        <ice:commandLink id="editMeasureGroup" actionListener="#{SetUpDataExplorationPage.editMeasureGroup}">
                                             <ice:outputText id="editMeasureGroupText" value="Edit"/>
                                        </ice:commandLink>
                                        <ice:commandLink id="deleteMeasureGroup" action="#{SetUpDataExplorationPage.deleteMeasureGroup}">
                                             <ice:outputText id="deleteMeasureGroupText" value="Delete"/>
                                        </ice:commandLink>
                                    </h:column>
                                </ice:dataTable>
                            </div>
                                 <ice:commandLink id="addMeasureGroupType" action="#{SetUpDataExplorationPage.addMeasureGroupType}">
                                      <ice:outputText id="addMeasureGroupTypeText" value="+Add Measure Type"/>
                                 </ice:commandLink>
                            </div>
                            <div jsfc="ice:panelGroup">
                                <ice:dataTable width="100%" cellspacing="0" cellpadding="0" var="groupType" value="#{SetUpDataExplorationPage.measureGroupTypes}"
                                               binding="#{SetUpDataExplorationPage.dataTableVarGroupType}">
                                    <h:column>
                                        <f:facet name="header">
                                            <ice:outputLabel value="Name"/>
                                        </f:facet>
                                        <ice:outputText value="#{groupType.varGroupType.name}" rendered="#{!groupType.editMode}"/>
                                            <ice:inputText id="input_editMeasureType"
                                            visible="#{groupType.editMode}"
                                            value="#{groupType.varGroupType.name}"
                                            size="25"
                                            maxlength="255"
                                            binding="#{SetUpDataExplorationPage.editGroupTypeName}"/>
                                    </h:column>
                                     <h:column>
                                        <f:facet name="header">
                                            <ice:outputText value="Actions"/>
                                        </f:facet>
                                        <ice:commandLink id="editMeasureGroupType"
                                                         visible="#{!groupType.editMode}"
                                                         actionListener="#{SetUpDataExplorationPage.editMeasureType}">
                                             <ice:outputText id="editMeasureGroupTypeText" value="Edit"/>
                                        </ice:commandLink>
                                        <ice:commandLink id="saveMeasureGroupType"
                                                         visible="#{groupType.editMode}"
                                                         actionListener="#{SetUpDataExplorationPage.saveMeasureType}">
                                             <ice:outputText id="saveMeasureGroupTypeText" value="Save"/>
                                        </ice:commandLink>
                                        <ice:commandLink id="deleteMeasureGroupType"
                                                         visible="#{!groupType.editMode}"
                                                         action="#{SetUpDataExplorationPage.deleteMeasureGroupType}">
                                             <ice:outputText id="deleteMeasureGroupTypeText" value="Delete"/>
                                        </ice:commandLink>
                                    </h:column>
                                </ice:dataTable>
                            </div>
                        </div>
                        <div jsfc="ice:panelGroup" style="width:30%; float:left;" visible="#{SetUpDataExplorationPage.editMeasure}" rendered="#{SetUpDataExplorationPage.editMeasure}">
                            <ui:include src="SetUpDataExplorationPageMeasureEdit.xhtml"></ui:include>
                        </div>
                    </div>
                </div>
            </ice:panelTab>
            <ice:panelTab id="filters" label="Filters" url="/dvn#{VDCRequest.currentVDCURL}/faces/subsetting/SetUpDataExploration.xhtml&amp;tab=filters">
                <div jsfc="ice:panelGroup" panelLayout="flow">
                    <div jsfc="ice:panelGroup" style="overflow:hidden;">
                        <div jsfc="ice:panelGroup" style="width:60%; float:left; margin-right: 2em;">
                            <ice:commandLink id="addFilterGroup" action="#{SetUpDataExplorationPage.addFilterGrouping}">
                                 <ice:outputText id="addFilterGroupText" value="+ Add Group"/>
                            </ice:commandLink>
                            <div jsfc="ice:panelGroup">
                                <ice:dataTable id="filterPanelGroupings"
                                     width="100%" cellspacing="0" cellpadding="0" var="grouping" value="#{SetUpDataExplorationPage.filterGroupings}"
                                     binding="#{SetUpDataExplorationPage.dataTableFilterGrouping}">
                                    <h:column>

                                        <ice:outputLabel value="Group"/>

                                        <ice:outputText value="#{grouping.varGrouping.name}"/>

                                        <ice:commandLink id="editFilterGrouping" actionListener="#{SetUpDataExplorationPage.editFilterGroupingAction}">
                                                      <ice:outputText id="editFilterGroupingText" value="Edit Filter Group"/>

                                        <ice:outputText value="Group #{grouping.varGrouping.name}"/>
                                        <ice:commandLink id="editGroup" actionListener="#{SetUpDataExplorationPage.editFilterGroup}">
                                              <ice:outputText id="editFilterGroupText" value="Edit Filter Group"/>
                                        </ice:commandLink>
                                        /
                                        <ice:commandLink id="deleteFilterGroupType" binding="#{SetUpDataExplorationPage.deleteFilterGroupLink}"
                                                value="#{grouping.varGrouping.id}"
                                                partialSubmit="true"
                                                action="#{SetUpDataExplorationPage.deleteFilterGrouping}">
                                              <ice:outputText id="deleteFilterGroupText" value="Delete Filter Group"/>

                                       </ice:commandLink>

                                        </ice:commandLink>
                                        <div style="float:right;">
                                            <ice:commandLink id="addFilterGroupType" binding="#{SetUpDataExplorationPage.addFilterGroupTypeLink}"
                                                    value="#{grouping.varGrouping.id}"
                                                    action="#{SetUpDataExplorationPage.addFilterGroupType}">
                                                  <ice:outputText id="addFilterGroupText" value="+ Add Filter Type"/>
                                            </ice:commandLink>
                                        </div>
                                       

                                       <ice:commandLink id="addFilterGroup" binding="#{SetUpDataExplorationPage.addFilterGroupLink}"
                                                        value="#{grouping.varGrouping.id}"
                                                        action="#{SetUpDataExplorationPage.addFilterGroup}">
                                            <ice:outputText id="addFilterGroupText" value="+ Add Filter"/>
                                       </ice:commandLink>
                                       <ice:dataTable width="100%" cellspacing="0" cellpadding="0" var="filter" value="#{grouping.varGroupUI}"
                                                   binding="#{SetUpDataExplorationPage.dataTableFilterGroup}">
                                           <h:column>
                                               <f:facet name="header">
                                                   <ice:outputText value="Filter"/>
                                               </f:facet>
                                               <ice:outputText value="#{filter.varGroup.name}"/>
                                            </h:column>
                                            <h:column>
                                                <f:facet name="header">
                                                    <ice:outputText value="Type"/>
                                                </f:facet>
                                                <ice:outputText value="Types Selected: #{filter.groupTypesSelectedString}"/>

                                                </h:column>
                                            <h:column>
                                                <f:facet name="header">
                                                    <ice:outputText value="Variables"/>
                                                </f:facet>
                                                <ice:outputText value="Variables Selected: #{filter.numberOfVariablesSelected}"/>
                                            </h:column>
                                            <h:column>
                                                <f:facet name="header">
                                                    <ice:outputText value="Actions"/>
                                                </f:facet>
                                                <ice:commandLink id="editFilterGroup" actionListener="#{SetUpDataExplorationPage.editFilterGroup}">
                                                      <ice:outputText id="editFilterGroupText" value="Edit"/>
                                                </ice:commandLink>
                                                <ice:commandLink id="deleteFilterGroup" action="#{SetUpDataExplorationPage.deleteFilterGroup}">
                                                     <ice:outputText id="deleteFilterGroupText" value="Delete"/>
                                                </ice:commandLink>
                                            </h:column>
                                        </ice:dataTable>
                                        <ice:commandLink id="addFilterGroupType" binding="#{SetUpDataExplorationPage.addFilterGroupTypeLink}"
                                                value="#{grouping.varGrouping.id}"
                                                action="#{SetUpDataExplorationPage.addFilterGroupType}">
                                              <ice:outputText id="addFilterGroupText" value="+ Add Filter Type"/>
                                        </ice:commandLink>
                                       <ice:dataTable width="100%" cellspacing="0" cellpadding="0" var="type" value="#{grouping.varGroupTypesUI}"
                                                      binding="#{SetUpDataExplorationPage.dataTableFilterGroupType}">
                                    <h:column>
                                        <f:facet name="header">
                                            <ice:outputText value="Name"/>
                                        </f:facet>
                                        <ice:outputText value="#{type.varGroupType.name}" rendered="#{!type.editMode}"/>
                                            <ice:inputText id="input_editMeasureType"
                                            visible="#{type.editMode}"
                                            value="#{type.varGroupType.name}"
                                            size="25"
                                            maxlength="255"
                                            binding="#{SetUpDataExplorationPage.editFilterGroupTypeName}"/>
                                    </h:column>
                                     <h:column>
                                        <f:facet name="header">
                                            <ice:outputText value="Actions"/>
                                        </f:facet>
                                        <ice:commandLink id="editMeasureGroupType"
                                                         visible="#{!type.editMode}"
                                                         actionListener="#{SetUpDataExplorationPage.editFilterType}">
                                             <ice:outputText id="editMeasureGroupTypeText" value="Edit"/>
                                        </ice:commandLink>
                                        <ice:commandLink id="saveMeasureGroupType"
                                                         visible="#{type.editMode}"
                                                         actionListener="#{SetUpDataExplorationPage.saveFilterType}">
                                             <ice:outputText id="saveMeasureGroupTypeText" value="Save"/>
                                        </ice:commandLink>
                                        <ice:commandLink id="deleteMeasureGroupType"
                                                         visible="#{!type.editMode}"
                                                         action="#{SetUpDataExplorationPage.deleteFilterGroupType}">
                                             <ice:outputText id="deleteMeasureGroupTypeText" value="Delete"/>
                                        </ice:commandLink>
                                    </h:column>
                                       </ice:dataTable>
                                    </h:column>
                                </ice:dataTable>
                            </div>
                        </div>
                        <div jsfc="ice:panelGroup" style="width:35%; float:left;" 
                             visible="#{SetUpDataExplorationPage.editFilterGroup or SetUpDataExplorationPage.editFilterGrouping}"
                             >

                            <ui:include src="SetUpDataExplorationPageFilterEdit.xhtml"></ui:include>
                        </div>
                    </div>
                </div>
            </ice:panelTab>
        </ice:panelTabSet>
    </div>
</ice:form>

</ui:define>
</ui:composition>
</body>
</html>
